<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Spring DB - 스프링 트랜잭션 전파" /><meta property="og:locale" content="en" /><meta name="description" content="트랜잭션 전파(propagation) 트랜잭션을 각각 사용하는 것이 아닌 하나의 트랜잭션이 이미 진행중인 상황에서 또다른 트랜잭션이 수행될떄, 어떤식으로 동작할지 결졍하는 것을 트랜잭션 전파(propagation) 이라 함." /><meta property="og:description" content="트랜잭션 전파(propagation) 트랜잭션을 각각 사용하는 것이 아닌 하나의 트랜잭션이 이미 진행중인 상황에서 또다른 트랜잭션이 수행될떄, 어떤식으로 동작할지 결졍하는 것을 트랜잭션 전파(propagation) 이라 함." /><link rel="canonical" href="https://issuh.github.io/posts/spring-db-08/" /><meta property="og:url" content="https://issuh.github.io/posts/spring-db-08/" /><meta property="og:site_name" content="My Technical Diary" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-10-18T16:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring DB - 스프링 트랜잭션 전파" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-11-02T10:48:17+09:00","datePublished":"2023-10-18T16:00:00+09:00","description":"트랜잭션 전파(propagation) 트랜잭션을 각각 사용하는 것이 아닌 하나의 트랜잭션이 이미 진행중인 상황에서 또다른 트랜잭션이 수행될떄, 어떤식으로 동작할지 결졍하는 것을 트랜잭션 전파(propagation) 이라 함.","headline":"Spring DB - 스프링 트랜잭션 전파","mainEntityOfPage":{"@type":"WebPage","@id":"https://issuh.github.io/posts/spring-db-08/"},"url":"https://issuh.github.io/posts/spring-db-08/"}</script><title>Spring DB - 스프링 트랜잭션 전파 | My Technical Diary</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="My Technical Diary"><meta name="application-name" content="My Technical Diary"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profile.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">My Technical Diary</a></div><div class="site-subtitle font-italic">ISSuh's tech blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/aboutme/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ISSuh" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yoyus5','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Spring DB - 스프링 트랜잭션 전파</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring DB - 스프링 트랜잭션 전파</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/ISSuh">ISSuh</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1697612400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-10-18 </em> </span> <span> Updated <em class="timeago" data-ts="1698889697" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-11-02 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6236 words"> <em>34 min</em> read</span></div></div></div><div class="post-content"><h3 id="트랜잭션-전파propagation"><span class="mr-2">트랜잭션 전파(propagation)</span><a href="#트랜잭션-전파propagation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>트랜잭션을 각각 사용하는 것이 아닌 하나의 트랜잭션이 이미 진행중인 상황에서 또다른 트랜잭션이 수행될떄, 어떤식으로 동작할지 결졍하는 것을 트랜잭션 전파(propagation) 이라 함.</p><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_01.png" alt="Alt text" data-proofer-ignore></p><ul><li>외부 트랜잭션이 수행중이고, 아직 끝나기 전 내부 트랜잭션이 수행<ul><li>먼저 실행된 트랜잭션이 상대적으로 밖에 있기 떄문에 외부 트랜잭션이라 함<li>외부 트랜잭션이 실행되고 있는 도중 호출되기 떄문에 마치 내부에 있는것으로 보여 내부 트랜잭션이라 함</ul><li>이 경우 스프링에선 외부 트랜잭션과 내부 트랜잭션을 묶어서 하나의 트랜잭션을 만들어 줌<ul><li>내부 트랜잭션이 외부 트랜잭션에 참여<li>위와 같은 방식이 기본동작이며 옵션을 통해 다른 동작방식으로 선탱할 수 있음</ul></ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_02.png" alt="Alt text" data-proofer-ignore></p><ul><li>스프링에선 개념적으로 물리 트랜잭션, 논리 트랜잭션이라고 나눔<ul><li>물리 트랜잭션은 실제 데이터베이스에 적용되는 트랜잭션을 뜻함<ul><li>실제 커넥션을 통해 트랜잭션을 시작(setAutoCommit(false))하고, 실제 커넥션을 통해 커밋, 롤백하는 단위</ul><li>논리 트랜잭션은 트랜잭션 매니저를 통해 트랜잭션을 사용하는 단위</ul><li>논리 트랜잭션들은 하나의 물리 트랜잭션으로 묶임<ul><li>기본인 REQUIRED 전파옵션을 사용할 할시, 이러한 논리 트랜잭션 개념은 트랜잭션이 진행되는 중에 내부에 추가로 트랜잭션을 사용하는 경우에 나타남</ul></ul><p>이와 같이 물리 트랜잭션, 논리 트랜잭션으로 나누면 다음과 같은 단순한 원칙을 만들 수 있음</p><ul><li><strong>모든 논리 트랜잭션이 커밋되어야 물리 트랜잭션이 커밋 됨</strong><li><strong>하나의 논리 트랜잭션이라도 롤백되면 물리 트랜잭션은 롤백 됨</strong></ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_03.png" alt="Alt text" data-proofer-ignore></p><ul><li>모든 논리 트랜잭션이 커밋되었으므로 물리 트랜잭션도 커밋</ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_04.png" alt="Alt text" data-proofer-ignore></p><ul><li>외부 트랜잭션이 롤백되었으므로 내부 트랜잭션이 커밋되어도 물리 트랜잭션은 롤백<li>반대로 내부 트랜잭션이 롤백, 외부 트랜잭션이 커밋되어도 물리 트랜잭션은 롤백</ul><p>이러한 외부 트랜잭션과 내부 트랜잭션에 대하여 테스트 코드로 확인해 볼 수 있음</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">inner_commit</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"외부 트랜잭션 시작"</span><span class="o">);</span>
  <span class="nc">TransactionStatus</span> <span class="n">outer</span> <span class="o">=</span> <span class="n">txManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">(</span><span class="k">new</span> <span class="nc">DefaultTransactionAttribute</span><span class="o">());</span>
  <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"outer.isNewTransaction()={}"</span><span class="o">,</span> <span class="n">outer</span><span class="o">.</span><span class="na">isNewTransaction</span><span class="o">());</span>
  
  <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"내부 트랜잭션 시작"</span><span class="o">);</span>
  <span class="nc">TransactionStatus</span> <span class="n">inner</span> <span class="o">=</span> <span class="n">txManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">(</span><span class="k">new</span> <span class="nc">DefaultTransactionAttribute</span><span class="o">());</span>
  <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"inner.isNewTransaction()={}"</span><span class="o">,</span> <span class="n">inner</span><span class="o">.</span><span class="na">isNewTransaction</span><span class="o">());</span>
  <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"내부 트랜잭션 커밋"</span><span class="o">);</span>
  <span class="n">txManager</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">inner</span><span class="o">);</span>
  
  <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"외부 트랜잭션 커밋"</span><span class="o">);</span>
  <span class="n">txManager</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">outer</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li>외부 트랜잭션 수행중 내부 트랜잭션을 추가로 수행<li>외부 트랜잭션은 처음 수행된 트랜잭션이며 이 경우 신규 트랜잭션(isNewTransaction=true)가 됨<li>내부 트랜잭션을 시작하는 시점에는 이미 외부 트랜잭션이 진행중인 상태이며 이 경우 내부 트랜잭션은 외부 트랜잭견에 참여하는 형태가 됨<li>트랜잭션 참여<ul><li>내부 트랜잭션이 외부 트랜잭션에 참여한다는 뜻은 내부 트랜잭션이 외부 트랜잭션을 그대로 이어 받아 따른다는 뜻<li>다른 관점으로 보면 외부 트랜잭션의 범위가 내부 트랜잭션까지 넓어진다는 뜻<li>외부에서 시작된 물리적인 트랜잭션의 범위가 내부 트랜잭션까지 넓어진다는 뜻<li>즉, <strong>외부 트랜잭션과 내부 트랜잭션이 하나의 물리 트랜잭션으로 묶여버리게 됨</strong></ul><li>내부 트랜잭션은 이미 진행되고 있는 트랜잭션에 참여하므로 신규 트랜잭션이 아님(isNewTransaction=false)</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre># 실행 결과
외부 트랜잭션 시작
Creating new transaction with name [null]: 
PROPAGATION_REQUIRED,ISOLATION_DEFAULT
Acquired Connection [HikariProxyConnection@1943867171 wrapping conn0] for JDBC 
transaction
Switching JDBC Connection [HikariProxyConnection@1943867171 wrapping conn0] to 
manual commit
outer.isNewTransaction()=true

내부 트랜잭션 시작
Participating in existing transaction
inner.isNewTransaction()=false

내부 트랜잭션 커밋
외부 트랜잭션 커밋
Initiating transaction commit
Committing JDBC transaction on Connection [HikariProxyConnection@1943867171 
wrapping conn0]
Releasing JDBC Connection [HikariProxyConnection@1943867171 wrapping conn0] 
after transaction
</pre></table></code></div></div><ul><li>내부 트랜잭션을 시작할 때 Participating in existing transaction 이라는 메시지를 확인할 수 있음. 이 메시지는 내부 트랜잭션이 기존에 존재하는 외부 트랜잭션에 참여한다는 뜻<li>외부 트랜잭션만 물리 트랜잭션을 시작하고, 커밋 함<li>내부 트랜잭션이 실제 물리 트랜잭션을 커밋하면 트랜잭션이 끝나버리기 때문에, 트랜잭션을 처음 시작한 외부 트랜잭션 까지 이어갈 수 없음. 그러므로 내부 트랜잭션은 DB 커넥션을 통한 물리 트랜잭션을 커밋하면 안됨<li>스프링은 이렇게 여러 트랜잭션이 함꼐 사용되는 경우, <strong>처음 트랜잭션을 시작한 외부 트랜잭션이 실제 물리 트랜잭션을 관리</strong>하도록 함. 이를 통해 트랜잭션 중복 커밋 문제를 해결 함</ul><h4 id="트랜잭션-전파의-동작-흐름"><span class="mr-2">트랜잭션 전파의 동작 흐름</span><a href="#트랜잭션-전파의-동작-흐름" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_05.png" alt="Alt text" data-proofer-ignore> <strong>요청 흐름 - 외부 트랜잭션</strong> 1.. txManager.getTransaction()을 호출하여 외부 트랙잭션을 시작</p><ol><li>트랜잭션 매니저는 데이터소스를 통해 커넥션을 생성<li>생성한 커넥션을 수동 커밋 모드(setAutoCommit(false))로 설정(<strong>물리 트랜잭션 시작</strong>)<li>트랜잭션 매니저는 트랜잭션 동기화 매니저에 커넥션을 보관<li>트랜잭션 매니저는 트랜잭션을 생성하여 반환 <br />   * 트랜잭션 매니저는 트랜잭션을 생성한 결과를 TransactionStatus에 담아서 반환하는데, 여기에 신규 트랜잭션의 여부가 담겨 있음. \<li>로직 1이 수행되고, 커넥션이 필요한 경우 트랜잭션 동기화 매니저를 통해 트랜잭션이 적용된 커넥션을 획득하여 사용</ol><p><strong>요청 흐름 - 내부 트랜잭션</strong></p><ol><li>txManager.getTransaction() 를 호출해서 내부 트랜잭션을 시작<li>트랜잭션 매니저는 트랜잭션 동기화 매니저를 통해서 기존 트랜잭션이 존재하는지 확인<li>기존 트랜잭션이 존재하므로 기존 트랜잭션에 참여 함 <br />   * 기존 트랜잭션에 참여한다는 뜻은 사실 아무것도 하지 않는다는 뜻 <br />   * 이미 기존 트랜잭션인 외부 트랜잭션에서 물리 트랜잭션을 시작하였고 물리 트랜잭션이 시작된 커넥션을 트랜잭션 동기화 매니저에 담아두어 둔 상태 <br />   * 이후 로직은 자연스럽게 트랜잭션 동기화 매니저에 보관된 기존 커넥션을 사용하게 됨 \<li>트랜잭션 매니저는 기존 생성되었던 트랜잭션을 찾아서 반환 <br />   * 트랜잭션 매니저는 트랜잭션을 생성한 결과를 TransactionStatus 에 담아서 반환하는데, 여기에서 isNewTransaction 를 통해 신규 트랜잭션 여부를 확인할 수 있음. 여기서는 기존 트랜잭션에 참여했기 때문에 신규 트랜잭션이 아님(false) \<li>로직2가 수행되고, 커넥션이 필요한 경우 트랜잭션 동기화 매니저를 통해 외부 트랜잭션이 보관한 커넥션을 획득해서 사용</ol><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_06.png" alt="Alt text" data-proofer-ignore> <strong>응답 흐름 - 내부 트랜잭션</strong></p><ol><li>로직2가 끝나고 트랜잭션 매니저를 통해 내부 트랜잭션을 커밋<li>트랜잭션 매니저는 커밋 시점에 신규 트랜잭션 여부에 따라 다르게 동작 함. 이 경우 신규 트랜잭션이 아니기 때문에 실제 커밋을 호출하지 않음. <br />   * 실제 커넥션에 커밋이나 롤백을 호출하면 물리 트랜잭션이 끝나버리기 때문에 아직 트랜잭션이 끝난 것이 아닌 이 시점에는 실제 커밋을 호출하면 안됨. <br />   * 물리 트랜잭션은 외부 트랜잭션을 종료할 때 까지 이어져야 함 \</ol><p><strong>응답 흐름 - 외부 트랜잭션</strong></p><ol><li>로직1이 끝나고 트랜잭션 매니저를 통해 외부 트랜잭션을 커밋<li>트랜잭션 매니저는 커밋 시점에 신규 트랜잭션 여부에 따라 다르게 동작한다. 외부 트랜잭션은 신규 트랜잭션 이므로 DB 커넥션에 실제 커밋을 호출<li>트랜잭션 매니저에 커밋하는 것이 논리적인 커밋이라면, 실제 커넥션에 커밋하는 것을 물리 커밋이라 할 수 있음. 실제 데이터베이스에 커밋이 반영되고, 물리 트랜잭션도 끝난다</ol><h5 id="트랜잭션-전파의-동작-흐름-정리"><span class="mr-2">트랜잭션 전파의 동작 흐름 정리</span><a href="#트랜잭션-전파의-동작-흐름-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><ul><li>주요 핵심은 트랜잭션 매니저에 커밋을 호출한다고 해서 항상 실제 커넥션에 물리 커밋이 발생하지 않는다는 것<li>신규 트랜잭션인 경우에만 실제 커넥션을 사용하여 물리 커밋과 롤백을 수행함. 신규 트랜잭션이 아니면 실제 물리 커밋을 수행하지 않음<li>트랜잭션이 내부에서 추가로 사용되면 트랜잭션 매니저에 커밋하는 것이 항상 물리 커밋으로 이어지지 않음. 그러므로 이러한 경우 논리 트랜잭션과 물리 트랜잭션으로 나뉘어 지게 됨. 또는 외부 트랜잭션과 내부 트랜잭션으로 나누어 설명하기도 함<li>트랜잭션이 내부에서 추가로 사용되면 트랜잭션 매니저를 통해 논리 트랜잭션을 관리하고 모든 논리 트랜잭션이 커밋되면 물리 트랜잭션이 커밋 됨</ul><h4 id="외부-롤백시-흐름"><span class="mr-2">외부 롤백시 흐름</span><a href="#외부-롤백시-흐름" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_04.png" alt="Alt text" data-proofer-ignore> 내부 트랜잭션은 커밋이 되는데 외부에서 트랜잭션이 롤백이 된다면, 내부 트랜잭션안 에서 저장한 데이터도 모두 함께 롤백 됨</p><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_07.png" alt="Alt text" data-proofer-ignore> <strong>응답 흐름 - 내부 트랜잭션</strong> 1, 로직2가 끝나고 트랜잭션 매니저를 통해 내부 트랜잭션을 커밋 \</p><ol><li>트랜잭션 매니저는 커밋 시점에 신규 트랜잭션 여부에 따라 다르게 동작 함. 이 경우 신규 트랜잭션이 아니기 때문에 실제 커밋을 호출하지 않음. <br />   * 실제 커넥션에 커밋이나 롤백을 호출하면 물리 트랜잭션이 끝나버리기 때문에 아직 트랜잭션이 끝난 것이 아닌 이 시점에는 실제 커밋을 호출하면 안됨. <br />   * 물리 트랜잭션은 외부 트랜잭션을 종료할 때 까지 이어져야 함 \</ol><p><strong>응답 흐름 - 외부 트랜잭션</strong></p><ol><li>로직1이 끝나고 트랜잭션 매니저를 통해 외부 트랜잭션을 롤백<li>트랜잭션 매니저는 롤백 시점에 신규 트랜잭션 여부에 따라 다르게 동작한다. 외부 트랜잭션은 신규 트랜잭션이므로 DB 커넥션에 실제 롤백을 호출<li>트랜잭션 매니저에 롤백하는 것이 논리적인 롤백이라면, 실제 커넥션에 롤백하는 것을 물리 롤백이라 할 수 있음. 실제 데이터베이스에 롤백이 반영되고, 물리 트랜잭션도 끝나게 됨</ol><h4 id="내부-롤백시-흐름"><span class="mr-2">내부 롤백시 흐름</span><a href="#내부-롤백시-흐름" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_08.png" alt="Alt text" data-proofer-ignore> 외부 롤백시의 흐름과 다르게 내부 트랜잭션은 롤백되고 외부 트랜잭션이 커밋되는 상황이라면 단순히 해결되지 않는 문제가 발생함.</p><p>이에 대하여 응답 흐름을 확인해보면 아래와 같음</p><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_09.png" alt="Alt text" data-proofer-ignore> <strong>응답 흐름 - 내부 트랜잭션</strong> 1, 로직2가 끝나고 트랜잭션 매니저를 통해 내부 트랜잭션을 롤백</p><ol><li>트랜잭션 매니저는 롤백 시점에 신규 트랜잭션 여부에 따라 다르게 동작함. 이 경우 신규 트랜잭션이 아니기 때문에 실제 롤백을 호출하지 않음 <br />   * 실제 커넥션에 커밋이나 롤백을 호출하면 물리 트랜잭션이 끝나버리기 때문에 아직 트랜잭션이 끝난 것이 아닌 이 시점에는 실제 커밋을 호출하면 안됨. <br />   * 물리 트랜잭션은 외부 트랜잭션을 종료할 때 까지 이어져야 함 \<li>내부 트랜잭션은 물리 트랜잭션을 롤백하지 않는 대신에 트랜잭션 동기화 매니저에 <strong>rollbackOnly=true</strong> 라는 표시를 해둠 \</ol><p><strong>응답 흐름 - 외부 트랜잭션</strong></p><ol><li>로직1이 끝나고 트랜잭션 매니저를 통해 외부 트랜잭션을 커밋<li>트랜잭션 매니저는 커밋 시점에 신규 트랜잭션 여부에 따라 다르게 동작 함. 외부 트랜잭션은 신규 트랜잭션이므로 DB 커넥션에 실제 커밋을 호출해야 하지만, 트랜잭션 동기화 매니저에 <strong>롤백 전용(<em>rollbackOnly=true</em>) 표시</strong>가 있는지 확인화고, 롤백 전용 표시가 있으면 물리 트랜잭션을 커밋하는 것이 아니라 롤백을 진행 함<li>실제 데이터베이스에 롤백이 반영되고, 물리 트랜잭션도 끝남<li>트랜잭션 매니저에 커밋을 호출한 개발자 입장에서는 분명 커밋을 기대했는데 롤백 전용 표시로 인해 실제로는 롤백이 되었기 때문에 이를 <strong>UnexpectedRollbackException</strong> 런타임 예외를 통해 알림 <br />   * 시스템 입장에서는 커밋을 호출했지만 롤백이 되었다는 것은 분명하게 알려주어야 함 <br />   * 예를 들어서 고객은 주문이 성공했다고 생각했는데, 실제로는 롤백이 되어서 주문이 생성되지 않은 상황 <br />   * 스프링은 이 경우 <strong>UnexpectedRollbackException</strong> 런타임 예외를 던져 커밋을 시도했지만 기대하지 않은 롤백이 발생했다는 것을 명확하게 알려줌 \</ol><h4 id="트랜잭션-전파-흐름-정리"><span class="mr-2">트랜잭션 전파 흐름 정리</span><a href="#트랜잭션-전파-흐름-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>논리 트랜잭션이 하나라도 롤백이 되면 물리 트랜잭션 또한 롤백을 진행함<li>내부 논리 트랜잭션이 롤백되면 롤백 전용 마크를 표시함<li>외부 트랜잭션을 커밋 할 떄 롤백 전용 마크를 확인하고, 롤백 전용 마크가 표시되어 있다면 물리 트랜잭션을 롤백한뒤, 만일 외부 트랜잭션이 롤백이 아닌 커밋을 한다면 UnexpectedRollbackException 예외를 던짐</ul><h3 id="requires_new"><span class="mr-2">REQUIRES_NEW</span><a href="#requires_new" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>외부 트랜잭션과 내부 트랜잭션을 완전히 분리해서 사용하는 방법도 있음 이 방법은 내부 트랜잭션에 문제가 발생해도 외부 트랜잭션에는 영향을 주지 않음. 반대로 외부 트랜잭션에 문제가 발생해도 내부 트랜잭션에 영향을 주지 않음</p><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_10.png" alt="Alt text" data-proofer-ignore></p><ul><li>이렇게 물리 트랜잭션을 분리하기 위해 내부 트랜잭션을 시작할때 REQUIRES_NEW 옵션을 사용<li>외부 트랜잭션과 내부 트랜잭션이 각각 별도의 물리 트랜잭션을 가짐<ul><li>DB 커넥션을 각각 따로 사용함</ul><li>내부 트랜잭션이 롤백되더라도 외부 트랜잭션에서 수행한 데이터에는 영향을 주지 않음</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">inner_rollback_requires_new</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"외부 트랜잭션 시작"</span><span class="o">);</span>
    <span class="nc">TransactionStatus</span> <span class="n">outer</span> <span class="o">=</span> <span class="n">txManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">(</span><span class="k">new</span> <span class="nc">DefaultTransactionAttribute</span><span class="o">());</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"outer.isNewTransaction()={}"</span><span class="o">,</span> <span class="n">outer</span><span class="o">.</span><span class="na">isNewTransaction</span><span class="o">());</span>

    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"내부 트랜잭션 시작"</span><span class="o">);</span>
    <span class="c1">// 별도의 DefaultTransactionAttribute 객체를 만들고</span>
    <span class="c1">// setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRES_NEW)</span>
    <span class="c1">// 을 통해 물리 트랜잭션을 분리</span>
    <span class="nc">DefaultTransactionAttribute</span> <span class="n">definition</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultTransactionAttribute</span><span class="o">();</span>
    <span class="n">definition</span><span class="o">.</span><span class="na">setPropagationBehavior</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">PROPAGATION_REQUIRES_NEW</span><span class="o">);</span>
    <span class="nc">TransactionStatus</span> <span class="n">inner</span> <span class="o">=</span> <span class="n">txManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">(</span><span class="n">definition</span><span class="o">);</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"inner.isNewTransaction()={}"</span><span class="o">,</span> <span class="n">inner</span><span class="o">.</span><span class="na">isNewTransaction</span><span class="o">());</span>

    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"내부 트랜잭션 롤백"</span><span class="o">);</span>
    <span class="n">txManager</span><span class="o">.</span><span class="na">rollback</span><span class="o">(</span><span class="n">inner</span><span class="o">);</span> <span class="c1">//롤백</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"외부 트랜잭션 커밋"</span><span class="o">);</span>
    <span class="n">txManager</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">outer</span><span class="o">);</span> <span class="c1">//커밋</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>외부 트랜잭션 시작
Creating new transaction with name [null]: 
PROPAGATION_REQUIRED,ISOLATION_DEFAULT
Acquired Connection [HikariProxyConnection@1064414847 wrapping conn0] for JDBC 
transaction
Switching JDBC Connection [HikariProxyConnection@1064414847 wrapping conn0] to 
manual commit
outer.isNewTransaction()=true

내부 트랜잭션 시작
Suspending current transaction, creating new transaction with name [null]
Acquired Connection [HikariProxyConnection@778350106 wrapping conn1] for JDBC 
transaction
Switching JDBC Connection [HikariProxyConnection@778350106 wrapping conn1] to 
manual commit
inner.isNewTransaction()=true

내부 트랜잭션 롤백
Initiating transaction rollback
Rolling back JDBC transaction on Connection [HikariProxyConnection@778350106 
wrapping conn1]
Releasing JDBC Connection [HikariProxyConnection@778350106 wrapping conn1] 
after transaction
Resuming suspended transaction after completion of inner transaction

외부 트랜잭션 커밋
Initiating transaction commit
Committing JDBC transaction on Connection [HikariProxyConnection@1064414847 
wrapping conn0]
Releasing JDBC Connection [HikariProxyConnection@1064414847 wrapping conn0] 
after transaction
</pre></table></code></div></div><ul><li><strong>외부 트랜잭션 시작</strong><ul><li>외부 트랜잭션을 시작하면서 커넥션를 획득하고 manual commit 으로 변경하여 물리 트랜잭션을 시작<li>외부 트랜잭션은 신규 트랜잭션임</ul><li><strong>내부 트랜잭션 시작</strong><ul><li>내부 트랜잭션을 시작하면서 커넥션를 획득하고 manual commit 으로 변경하여 물리 트랜잭션을 시작<li>내부 트랜잭션은 외부 트랜잭션에 참여하는것이 아닌 PROPAGATION_REQUIRES_NEW 옵션을 사용했기 때문에 완전히 새로운 트랜잭션으로 생성됨</ul><li><strong>내부 트랜잭션 롤백</strong><ul><li>내부 트랜잭션을 롤백<li>내부 트랜잭션은 신규 트랜잭션이기 때문에 실제 물리 트랜잭션을 롤백</ul><li><strong>외부 트랜잭션 커밋</strong><ul><li>외부 트랜잭션을 커밋<li>외부 트랜잭션은 신규 트랜잭션이기 때문에 실제 물리 트랜잭션을 커밋</ul></ul><h4 id="requires_new-옵션-사용시-트랜잭션-전파의-동작-흐름"><span class="mr-2">REQUIRES_NEW 옵션 사용시, 트랜잭션 전파의 동작 흐름</span><a href="#requires_new-옵션-사용시-트랜잭션-전파의-동작-흐름" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_11.png" alt="Alt text" data-proofer-ignore> <strong>요청 흐름 - 외부 트랜잭션</strong> 1, txManager.getTransaction()을 호출하여 외부 트랙잭션을 시작</p><ol><li>트랜잭션 매니저는 데이터소스를 통해 커넥션을 생성<li>생성한 커넥션을 수동 커밋 모드(setAutoCommit(false))로 설정(<strong>물리 트랜잭션 시작</strong>)<li>트랜잭션 매니저는 트랜잭션 동기화 매니저에 커넥션을 보관<li>트랜잭션 매니저는 트랜잭션을 생성하여 반환 <br />   * 트랜잭션 매니저는 트랜잭션을 생성한 결과를 TransactionStatus에 담아서 반환하는데, 여기에 신규 트랜잭션의 여부가 담겨 있음.<li>로직 1이 수행되고, 커넥션이 필요한 경우 트랜잭션 동기화 매니저를 통해 트랜잭션이 적용된 커넥션을 획득하여 사용</ol><p><strong>요청 흐름 - 내부 트랜잭션</strong></p><ol><li><strong>REQUIRES_NEW 옵션</strong>과 함께 txManager.getTransaction() 를 호출해서 내부 트랜잭션을 시작 <br />   *트랜잭션 매니저는 REQUIRES_NEW 옵션을 확인하고, 기존 트랜잭션에 참여하는 것이 아닌 새로운 트랜잭션을 시작함<li>트랜잭션 매니저는 데이터소스를 통해 커넥션을 생성<li>생성한 커넥션을 수동 커밋 모드(setAutoCommit(false))로 설정(<strong>물리 트랜잭션 시작</strong>)<li>트랜잭션 매니저는 트랜잭션 동기화 매니저에 커넥션을 보관 <br />   * 이때 외부 트랜잭션의 커넥션인 con1은 잠시 보류 되고 con2가 사용됨 <br />   * 내부 트랜잭션을 완료 할 떄 까지 con2가 사용됨<li>트랜잭션 매니저는 신규 트랜잭션을 생성한 결과를 반환<li>로직 2이 수행되고, 커넥션이 필요한 경우 트랜잭션 동기화 매니저를 통해 트랜잭션이 적용된 커넥션을 획득하여 사용</ol><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_08_12.png" alt="Alt text" data-proofer-ignore> <strong>응답 흐름 - 내부 트랜잭션</strong></p><ol><li>로직2가 끝나고 트랜잭션 매니저를 통해 내부 트랜잭션을 롤백<li>트랜잭션 매니저는 롤백 시점에 신규 트랜잭션 여부에 따라 다르게 동작 함. 현재 신규 트랜잭션이므로 롤백을 수행 함<li>내부 트랜젝션이 con2 물리 트랜잭션을 롤백 함 <br />   * 트랜잭션이 종료되고, con2는 종료되거나 커넥션 풀에 반납 됨 <br />   * 이후 con1의 보류가 끝나고, 다시 con1을 사용 함 \</ol><p><strong>응답 흐름 - 외부 트랜잭션</strong></p><ol><li>외부 트랜잭션에 커밋을 요청<li>외부 트랜잭션은 신규 트랜잭션 이므로 물리 트랜잭션에 커밋 진행<li>이떄 rollbackOnly 설정을 체크 함. 위 상황에는 rollbackOnly 설정이 없으므로 커밋 진행<li>본인이 만든 con1 커넥션을 통해 물리 트랜잭션을 커밋 <br />   * 트랜잭션이 종료되고, con1는 종료되거나 커넥션 풀에 반납 됨 \</ol><p><br />&lt;/br&gt;</p><ul><li>정리<ul><li>REQUIRES_NEW 옵션을 사용하면 물리 트랜잭션이 명확하게 분리 됨<li>REQUIRES_NEW 옵션을 사용하면 데이터베이스 커넥션이 동시에 다수(내부 트랜잭션의 수)가 사용된 다는 점을 주의</ul></ul><h3 id="다양한-전파-옵션"><span class="mr-2">다양한 전파 옵션</span><a href="#다양한-전파-옵션" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>스프링은 다양한 트랜잭션 전파 옵션을 제공 함. 전파 옵션에 대해 별도의 설정을 하지 않으면 기본으로 REQUIRED 가 사용됨. 실무에서는 대부분 REQUIRED 옵션을 사용하고 가끔 REQUIRED_NEW 가 사용되며 나머지는 잘 사용되지 않음</p><ul><li><strong>REQUIRED</strong><ul><li>가장 많이 사용되는 기본 설정<li>기존 트랜잭션이 없으면 생성하고 있으면 참여 함<li>트랜잭션이 필수라는 의미<li>기존 트랜잭션 없음 : 새로운 트랜잭션을 생성<li>기존 트랜잭션 있음 : 기존 트랜잭션에 참여</ul><li><strong>REQUIRED_NEW</strong><ul><li>할상 새로운 트랜잭션을 생성<li>기존 트랜잭션 없음 : 새로운 트랜잭션을 생성<li>기존 트랜잭션 있음 : 새로운 트랜잭션을 생성</ul><li><strong>SUPPORT</strong><ul><li>트랜잭션을 지원한 다는 뜻이며 기존 트랜잭션이 없으면 없는대로 진행하고 있다면 참여 함<li>기존 트랜잭션 없음 : 트랜잭션 없이 진행<li>기존 트랜잭션 있음 : 기존 트랜잭션에 참여</ul><li><strong>NOT_SUPPORT</strong><ul><li>트랜잭션을 지원하지 않는 다는 의미<li>기존 트랜잭션 없음 : 트랜잭션 없이 진행<li>기존 트랜잭션 있음 : 트랜잭션 없이 진행하며 기존 트랜잭션은 보류 함</ul><li><strong>MANDATORY</strong><ul><li>의무사항으로, 트랜잭션이 반드시 있어야 하며 기존 트랜잭션이 없다면 예외 발생<li>기존 트랜잭션 없음 : IllegalTransactionStateException 예외 발생<li>기존 트랜잭션 있음 : 기존 트랜잭션에 참여</ul><li><strong>NEVER</strong><ul><li>트랜잭션을 사용하지 않는다는 의미이며 기존 트랜잭셩이 있다면 예외가 발생<li>기존 트랜잭션도 허용하지 않는 강한 부정의 의미<li>기존 트랜잭션 없음 : 트랜잭션 없이 진행<li>기존 트랜잭션 있음 : IllegalTransactionStateException 예외 발생</ul><li><strong>NESTED</strong><ul><li>기존 트랜잭션 없음 : 새로운 트랜잭션을 생성<li>기존 트랜잭션 있음 : 중첩 트랜잭션에 참여<ul><li>중첩 트랜잭션은 외부 트랜잭션의 영향을 받지만 중첩 트랜잭션은 외부에 영향을 주지 않음<li>중첩 트랜잭션이 롤백 되어도 외부 트랜잭션은 커밋할 수 있음<li>외부 트랜잭션이 롤백 되면 중첩 트랜잭션도 함께 롤백 됨</ul><li>JDBC savepoint 기능을 하용하여 각 DB 드라이버별로 해당 기능을 지원하는지 확인이 필요<li>JPA 에선 중첩 트랜잭션을 사용할 수 없음</ul></ul><p>isolation, timeout, readOnly는 트랜잭션이 처음 시작될때만 적용 되며 트랜잭션에 참여하는 경우에는 적용되지 않음. 따라서 REQUIRED를 통한 트랜잭션 시작, REQUIRED_NEW를 통한 트랜잭션 시작 시점에만 적용 됨.</p><hr /><p>참고</p><ul><li>스프링 DB - 데이터 접근 활용 기술(김영한)</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/spring-db/'>Spring DB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >Web</a> <a href="/tags/spring-framework/" class="post-tag no-text-decoration" >Spring Framework</a> <a href="/tags/database/" class="post-tag no-text-decoration" >DataBase</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring DB - 스프링 트랜잭션 전파 - My Technical Diary&amp;url=https://issuh.github.io/posts/spring-db-08/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring DB - 스프링 트랜잭션 전파 - My Technical Diary&amp;u=https://issuh.github.io/posts/spring-db-08/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://issuh.github.io/posts/spring-db-08/&amp;text=Spring DB - 스프링 트랜잭션 전파 - My Technical Diary" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/educative-distributed-system-10/">Distributed Systems - Coordination Patterns</a><li><a href="/posts/educative-distributed-system-04/">Distributed Systems - CAP</a><li><a href="/posts/educative-distributed-system-03/">Distributed Systems - Replication</a><li><a href="/posts/my_project_simpledb/">simpleDB - 메모리</a><li><a href="/posts/ps-hackerrank-01/">HackerRandk - Fraudulent Activity Notifications</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-db-01/"><div class="card-body"> <em class="timeago small" data-ts="1697094600" > 2023-10-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring DB - JDBC 이해</h3><div class="text-muted small"><p> JDBC 표준 인터페이스 JDBC(Java Database Connectivity)는 자바에서 데이터베이스에 접속 할 수 있도록 하는 자바 API. JDBC는 데이터베이스에서 자료를 쿼리하거나 업데이트 하는 방법을 제공함 대표적으로 다음 3가지 기능을 표준 인터페이스로 정의해서 제공함 java.sql.Connection : 연결 java...</p></div></div></a></div><div class="card"> <a href="/posts/spring-db-02/"><div class="card-body"> <em class="timeago small" data-ts="1697163000" > 2023-10-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring DB - 커넥션풀과 데이터소스 이해</h3><div class="text-muted small"><p> 커넥션 풀 이해 데이터데이스 커넥션을 획득할 떄는 복잡한 과정을 걸치게 됨 어펄리케이션 로직은 DB 드라이버를 통해 커넥션 조회 DB 드라이버는 DB와 TCP/IP 커넥션 연결 DB 드라이버는 TCP/IP 커넥션이 연결되면 ID, PW와 기타 부가정보를 DB에 전달 DB는 ID, PW를 통해 내부 인증을 완료하고 내부에 DB 세션을...</p></div></div></a></div><div class="card"> <a href="/posts/spring-db-03/"><div class="card-body"> <em class="timeago small" data-ts="1697170200" > 2023-10-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring DB - 트랜잭션 이해</h3><div class="text-muted small"><p> 트랜잭션 데이터를 데이터베이스에 저장하는 대표적인 이유는 데이터베이스가 트랜잭션 이라는 개념을 지원하기 때문 트랜잭션이란 데이터베이스에서 하나의 작업을 안전하게 처리하도록 보장해주는 것을 뜻함 예를 들면, A가 B에게 1000원 계좌이체를 한다고 생각했을떄, A의 잔고 1000원 감소 B의 잔고 1000원 증가 위 두가지 작업이 합쳐 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-db-07/" class="btn btn-outline-primary" prompt="Older"><p>Spring DB - 스프링 트랜잭션의 이해</p></a> <a href="/posts/spring-mvc-02/" class="btn btn-outline-primary" prompt="Newer"><p>Spring MVC - 구조 이해</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/ISSuh">ISSuh</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-157715138-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-157715138-1'); }); </script>

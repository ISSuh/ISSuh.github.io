<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Design Patterns - Flyweight" /><meta property="og:locale" content="en" /><meta name="description" content="Structural Patterns - Flyweight" /><meta property="og:description" content="Structural Patterns - Flyweight" /><link rel="canonical" href="https://issuh.github.io/posts/design_patterns-flyweight/" /><meta property="og:url" content="https://issuh.github.io/posts/design_patterns-flyweight/" /><meta property="og:site_name" content="My Technical Diary" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-19T00:22:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Design Patterns - Flyweight" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-05T12:33:07+09:00","datePublished":"2020-04-19T00:22:00+09:00","description":"Structural Patterns - Flyweight","headline":"Design Patterns - Flyweight","mainEntityOfPage":{"@type":"WebPage","@id":"https://issuh.github.io/posts/design_patterns-flyweight/"},"url":"https://issuh.github.io/posts/design_patterns-flyweight/"}</script><title>Design Patterns - Flyweight | My Technical Diary</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="My Technical Diary"><meta name="application-name" content="My Technical Diary"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profile.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">My Technical Diary</a></div><div class="site-subtitle font-italic">ISSuh's tech blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/aboutme/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ISSuh" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yoyus5','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Design Patterns - Flyweight</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Design Patterns - Flyweight</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/ISSuh">ISSuh</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1587223320" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-04-19 </em> </span> <span> Updated <em class="timeago" data-ts="1646451187" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-03-05 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2013 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><h1 id="structural-patterns---flyweight">Structural Patterns - Flyweight</h1><h2 id="intent"><span class="mr-2">Intent</span><a href="#intent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>공유(sharing)을 통해 많은 수의 소립(fine-grained) 객체들을 효과적으로 지원한다.</p><h2 id="utility"><span class="mr-2">Utility</span><a href="#utility" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p><em>Flyweight Pattern</em>은 언제 사용하는가에 따라서 그 효과가 달라지게 된다.</p><ul><li>응용프로그램이 대량의 객체를 사용해야 할 때<li>객체의 수가 너무 많아져 저장 비용이 너무 높아질 때<li>대부분의 객체 상태를 부가적인 것으로 만들수 있을 때<li>부가적인 속성들을 제거한 후 객체들을 조사해 보니 객체의 많은 묶음이 비교적 적은 수의 공유된 객체로 대체될 수 있을 떄<li>현재 서로 다른 객체로 간주한 이유는 이들 부가적인 속성 때문이지 본질이 달랐던 것은 아닐 때<li>응용프로그램이 객체의 정체성에 의존하지 않을 때<ul><li><em>Flyweight</em> 객체들은 공유 될 수 있음을 의미하는데, 식별자가 있다는 것은 서로 다른 객체로 구별해야 한다는 의미 이므로 <em>Flyweight</em> 객체를 사용할 수 없다.</ul></ul><h2 id="structure"><span class="mr-2">Structure</span><a href="#structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><h3 id="basic-structure"><span class="mr-2">Basic Structure</span><a href="#basic-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="https://www.cs.unc.edu/~stotts/GOF/hires/Pictures/flywe050.gif" alt="example" data-proofer-ignore></p><p><img data-src="https://www.cs.unc.edu/~stotts/GOF/hires/Pictures/flywe051.gif" alt="example" data-proofer-ignore></p><h3 id="structure-example"><span class="mr-2">Structure Example</span><a href="#structure-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="https://www.cs.unc.edu/~stotts/GOF/hires/Pictures/flywe055.gif" alt="example" data-proofer-ignore></p><p><img data-src="https://www.cs.unc.edu/~stotts/GOF/hires/Pictures/flywe054.gif" alt="example" data-proofer-ignore></p><p><img data-src="https://www.cs.unc.edu/~stotts/GOF/hires/Pictures/flywe052.gif" alt="example" data-proofer-ignore></p><p><img data-src="https://www.cs.unc.edu/~stotts/GOF/hires/Pictures/flywe053.gif" alt="example" data-proofer-ignore></p><h3 id="elements"><span class="mr-2">Elements</span><a href="#elements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><strong>Flyweight</strong><ul><li><em>Graph</em>에 해당<li><em>Flyweight</em>가 받아들일 수 있고, 부가적인 상태에서 동작해야 하는 인터페이스를 정의</ul><li><strong>ConcreteFlyweight</strong><ul><li><em>Character</em>에 해당<li><em>Flyweight</em> 인터페이스를 구현<li>내부적으로 가지고 있어야 하는 본질적 상태에 대한 저상소를 정의<li><em>ConcreteFlyweight</em> 객체는 공유할 수 있어야 하므로, 관리하는 어떤 상태라도 본질적 이여야 함</ul><li><strong>UnsharedConcreteFlyweight</strong><ul><li><em>Row</em>, <em>Column</em>에 해당<li><em>Flyweight</em> 인터페이스는 공유를 가능하게 하지만, 그것을 강요해서는 안됨. 즉, 모든 <em>Flyweight</em>의 서브클래스들이 공유될 필요는 없음<li><em>UnsharedConcreteFlyweight</em> 객체는 <em>ConcreteFlyweight</em> 객체는 자신의 자식으로 가질수도 있음</ul><li><strong>FlyweightFactory</strong><ul><li><em>Flyweight</em> 객체를 생성하고 관리하며, <em>Flyweight</em> 객체가 제대로 공유되도록 보장<li>사용자가 <em>Flyweight</em> 객체를 요청하면, <em>FlyweightFactory</em> 객체는 이미 존재하고 있는 인스턴스를 제공하거나 만약 존재하지 않으면 새로 생성</ul><li><strong>Client</strong><ul><li><em>Flyweight</em> 객체레 대한 참조자를 관리하며 객체의 부가적 상태를 저장</ul></ul><p><em>Flyweight</em> 객체가 기능을 수행하는데 필요한 상태가 본직적인지, 부가적인 것인지를 구분해야 한다. 본질적인 상태는 <em>ConcreteFlyweight</em>에 저장해야 하고, 부가적인 상태는 사용자가 저장하거나, 연산되어야 하는 다른 상태로 관리해야 한다.</p><p>사용자는 <em>ConcreteFlyweight</em>의 인스턴스를 직접 만들수 없다. 사용자는 <em>ConcreteFlyweight</em> 객체를 <em>FlyweightFactory</em> 객체에서 얻어야 한다. 이렇게 해야 <em>Flyweight</em> 객체가 공유될 수 있다.</p><h2 id="feature"><span class="mr-2">Feature</span><a href="#feature" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p><em>Flyweight Pattern</em>은 예전에는 모두 본질적인 상태로 저장되어 있던 것을 부가적인 상태로 만들어, 부가적인 상태의 연산과 전송에 드는 런타임 비용을 새로 들여올 수 있다. 하지만 이런 비용은 <em>Flyweight</em> 객체의 공유를 통해 저장소 절약이라는 반대급부를 가질 수 있다.</p><ul><li>공유해야 하는 인스턴스의 전체 수를 줄일 수 있다.<li>객체별 본질적 상태의 양을 줄일 수 있다.<li>부가적인 상태는 연산되거나 저장될 수 있다.</ul><p>더 많은 <em>Flyweight</em>가 공유될 수록 저장소는 절약된다. 또한 공유할 상태가 많아 질수록 절약된다. 대부분의 본질적인 상태가 저장되고 부가적인 상태는 연산될 때라면 절약의 효과가 가장 크다. 이때는 본질적인 상태를 저장하는 비용이 줄어드는 대신, 부가적인 상태를 만들기 위한 연산의 시간이 들게 된다.</p><p><em>Flyweight Pattern</em>은 <em>Composite Pattern</em>과 조합하여 그래프와 같이 계층적 구조를 모델링하는데 자주 사용된다. 이렇게 하면, <em>Flyweight</em> 단말 노드들은 자신의 부모에 대한 포인터를 저정할 수 없기 때문에, 부모 포인터를 부가적 상태의 일부로서 <em>Flyweight</em> 객체에다가 매개변수로 전달해야 한다.</p><h2 id="implementation"><span class="mr-2">Implementation</span><a href="#implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><h3 id="considerations-point-in-implementaion"><span class="mr-2">Considerations point in implementaion</span><a href="#considerations-point-in-implementaion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="부가적-상태를-제외"><span class="mr-2">부가적 상태를 제외</span><a href="#부가적-상태를-제외" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><em>Flyweight Pattern</em>의 활용여부는 얼마나 쉽게 공유할 객체에서 부가적인 상태를 식별하고 이를 분리하는데 달려있다.</p><h4 id="공유할-객첼를-관리"><span class="mr-2">공유할 객첼를 관리</span><a href="#공유할-객첼를-관리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>객체는 공유할 수 있으므로, 사용자가 직접 인스턴스를 만들면 안된다. 그렇기 때문에 <em>FlyweightFactory</em>는 사용자가 특정한 <em>Flyweight</em> 객체를 찾아내게 한다.<em>FlyweightFactory</em> 객체는 연관 저장소를 써서 사용자가 자신이 관심있는 <em>Flyweight</em> 객체를 찾아볼 수 있게 한다.</p><h3 id="implement-example"><span class="mr-2">Implement Example</span><a href="#implement-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
</pre><td class="rouge-code"><pre>
<span class="c1">// Clone Minecraft's block(cube)</span>

<span class="cm">/**
* @brief Flyweight - CubeInfo
* @details 다량으로 생성될 객체들의 집합에서 공유될 공통 인터페이스 정의
*/</span>
<span class="k">class</span> <span class="nc">Cube</span><span class="p">{</span>
<span class="nl">public:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Cube</span><span class="p">()</span> <span class="p">{}</span>

  <span class="k">virtual</span> <span class="n">CubeType</span> <span class="n">getCubeType</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">setColor</span><span class="p">(</span><span class="n">ColorType</span> <span class="n">colorType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">ColorType</span> <span class="n">getColor</span><span class="p">()</span> <span class="k">const</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">virtual</span> <span class="n">ItemType</span> <span class="n">getItem</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
* @brief ConcreteFlyweight - RockCube
* @details Flyweight을 상속받아 공유되는 자신만의 인터페이스를 구현
*/</span>
<span class="k">class</span> <span class="nc">RockCube</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Cube</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">RockCube</span><span class="p">()</span> <span class="p">{</span> <span class="n">m_type</span> <span class="o">=</span> <span class="n">CUBE_TYPE_ROCK</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">RockCube</span><span class="p">()</span> <span class="p">{}</span>

  <span class="n">CubeType</span> <span class="n">getCubeType</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_type</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">void</span> <span class="n">setColor</span><span class="p">(</span><span class="n">ColorType</span> <span class="n">colorType</span><span class="p">)</span> <span class="p">{</span> <span class="n">m_color</span> <span class="o">=</span> <span class="n">m_color</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">ColorType</span> <span class="n">getColor</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_color</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">ItemType</span> <span class="n">getItem</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ITEM_TYPE_CUBE_ROCK</span><span class="p">;</span> <span class="p">};</span>

<span class="nl">private:</span>
  <span class="n">ColorType</span> <span class="n">m_color</span><span class="p">;</span>
  <span class="n">CubeType</span> <span class="n">m_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**
* @brief ConcreteFlyweight - SandCube
* @details Flyweight을 상속받아 공유되는 자신만의 인터페이스를 구현
*/</span>
<span class="k">class</span> <span class="nc">SandCube</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Cube</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">SandCube</span><span class="p">()</span> <span class="p">{</span> <span class="n">m_type</span> <span class="o">=</span> <span class="n">CUBE_TYPE_SAND</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">SandCube</span><span class="p">()</span> <span class="p">{}</span>

  <span class="n">CubeType</span> <span class="n">getCubeType</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_type</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">void</span> <span class="n">setColor</span><span class="p">(</span><span class="n">ColorType</span> <span class="n">colorType</span><span class="p">)</span> <span class="p">{</span> <span class="n">m_color</span> <span class="o">=</span> <span class="n">m_color</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">ColorType</span> <span class="n">getColor</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_color</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">ItemType</span> <span class="n">getItem</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ITEM_TYPE_CUBE_SAND</span><span class="p">;</span> <span class="p">};</span>

<span class="nl">private:</span>
  <span class="n">ColorType</span> <span class="n">m_color</span><span class="p">;</span>
  <span class="n">CubeType</span> <span class="n">m_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**
* @brief UnsharedConcreteFlyweight - MasterCube
* @details Flyweight을 상속받아 자신만의 인터페이스를 구현하지만 공유되지는 않음`
*/</span>
<span class="k">class</span> <span class="nc">MasterCube</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Cube</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">MasterCube</span><span class="p">()</span> <span class="p">{</span> <span class="n">m_type</span> <span class="o">=</span> <span class="n">CUBE_TYPE_MASTER</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">MasterCube</span><span class="p">()</span> <span class="p">{}</span>

  <span class="n">CubeType</span> <span class="n">getCubeType</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_type</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">void</span> <span class="n">setColor</span><span class="p">(</span><span class="n">ColorType</span> <span class="n">colorType</span><span class="p">)</span> <span class="p">{</span> <span class="n">m_color</span> <span class="o">=</span> <span class="n">m_color</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">ColorType</span> <span class="n">getColor</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_color</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">ItemType</span> <span class="n">getItem</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ITEM_TYPE_NONE</span><span class="p">;</span> <span class="p">};</span>

  <span class="kt">void</span> <span class="n">getPosition</span><span class="p">(</span><span class="n">Position</span> <span class="n">pos</span><span class="p">)</span> <span class="p">{</span> <span class="n">m_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">const</span> <span class="n">Position</span> <span class="n">getPosition</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_pos</span><span class="p">;</span> <span class="p">}</span>

<span class="nl">private:</span>
  <span class="n">Position</span> <span class="n">m_pos</span><span class="p">;</span>
  <span class="n">ColorType</span> <span class="n">m_color</span><span class="p">;</span>
  <span class="n">CubeType</span> <span class="n">m_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**
* @brief FlyweightFactory - CubeFacotory
* @details ConcreteFlyweight 객체의 공유 및 생성을 위한 메소드 정의
*/</span>
<span class="k">class</span> <span class="nc">CubeFacotory</span> <span class="p">{</span>
<span class="nl">public:</span>
  
  <span class="c1">// 공유되는 성질을 가지는 ConcreteFlyweight 객체 생성 및 반환</span>
  <span class="n">Cube</span><span class="o">*</span> <span class="n">getCubeInstance</span><span class="p">(</span><span class="n">CubeType</span> <span class="n">cubeType</span><span class="p">){</span>

    <span class="c1">// 현재 FlyweightFactory에 검색하는 타입의 ConcreteFlyweight 객체가 없을시,</span>
    <span class="c1">// 해당하는 타입의 ConcreteFlyweight 객체 생성</span>
    <span class="k">if</span><span class="p">(</span><span class="n">m_cubeNap</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">cubeType</span><span class="p">)</span> <span class="o">==</span> <span class="n">m_cubeMap</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span>
      <span class="k">switch</span><span class="p">(</span><span class="n">cubeType</span><span class="p">){</span>
        <span class="k">case</span> <span class="n">CUBE_TYPE_ROCK</span> <span class="p">:</span> <span class="p">{</span>
          <span class="n">m_cubeMap</span><span class="p">[</span><span class="n">cubeType</span><span class="p">]</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Cube</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">RockCube</span><span class="p">());</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">case</span> <span class="n">CUBE_TYPE_SAND</span> <span class="p">:</span> <span class="p">{</span>
          <span class="n">m_cubeMap</span><span class="p">[</span><span class="n">cubeType</span><span class="p">]</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Cube</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">SandCube</span><span class="p">());</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">m_cubeMap</span><span class="p">[</span><span class="n">cubeType</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="c1">// 공유되지 않은 성질을 가지는 UnsharedConcreteFlyweight 객체 생성</span>
  <span class="n">Cube</span><span class="o">*</span> <span class="n">CreateMasterCube</span><span class="p">(){</span> <span class="k">new</span> <span class="n">MasterCube</span><span class="p">();</span> <span class="p">}</span>

<span class="nl">private:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">CubeType</span><span class="p">,</span> <span class="n">Cube</span><span class="o">*&gt;</span> <span class="n">m_cubeMap</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">...</span>

  <span class="n">CubeFacotory</span> <span class="n">cubFactory</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Cube</span><span class="o">*&gt;</span> <span class="n">myCubeList</span><span class="p">;</span>
  
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
    <span class="n">CubeType</span> <span class="n">cubeType</span> <span class="o">=</span> <span class="n">randomCubeType</span><span class="p">();</span>
    <span class="n">myCubeList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cubFactory</span><span class="p">.</span><span class="n">getCubeInstance</span><span class="p">(</span><span class="n">cubeType</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="n">myCubeList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cubFactory</span><span class="p">.</span><span class="n">CreateMasterCube</span><span class="p">());</span>

<span class="p">...</span>

</pre></table></code></div></div><h2 id="related-pattern"><span class="mr-2">Related Pattern</span><a href="#related-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p><em>Flyweight</em>은 <em>Composite Pattern</em> 패턴과 함께 사용되는데, 공유되는 단말 노드를 가지는 방향성 비순환 그래프 형태를 써서 논리적으로 계층구조는 구현하는 것이 이에 해당한다.</p><p><em>State Pattern</em>또는 <em>Strategy Pattern</em>을 <em>Flyweight</em> 객체로 구현할 수 있다.</p><hr /><hr /><p><em>참고</em>. Design Patterns : Elements of Reusable Object-Oriented Software - Erich Gamma</p><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/design-patterns/'>Design Patterns</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/design-patterns/" class="post-tag no-text-decoration" >Design Patterns</a> <a href="/tags/structural-patterns/" class="post-tag no-text-decoration" >Structural Patterns</a> <a href="/tags/flyweight/" class="post-tag no-text-decoration" >Flyweight</a> <a href="/tags/c/" class="post-tag no-text-decoration" >C++</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Design Patterns - Flyweight - My Technical Diary&amp;url=https://issuh.github.io/posts/design_patterns-flyweight/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Design Patterns - Flyweight - My Technical Diary&amp;u=https://issuh.github.io/posts/design_patterns-flyweight/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://issuh.github.io/posts/design_patterns-flyweight/&amp;text=Design Patterns - Flyweight - My Technical Diary" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/educative-distributed-system-10/">Distributed Systems - Coordination Patterns</a><li><a href="/posts/educative-distributed-system-04/">Distributed Systems - CAP</a><li><a href="/posts/educative-distributed-system-03/">Distributed Systems - Replication</a><li><a href="/posts/my_project_simpledb/">simpleDB - 메모리</a><li><a href="/posts/ps-hackerrank-01/">HackerRandk - Fraudulent Activity Notifications</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/design_patterns-adapter/"><div class="card-body"> <em class="timeago small" data-ts="1586898480" > 2020-04-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Design Patterns - Adapter</h3><div class="text-muted small"><p> Structural Patterns - Adapter Intent 클래스의 인터페이스를 사용자가 기대하는 인터페이스 형태로 정응(변환)시킨다. 서로 일치하지 않는 인터페이스를 가지는 클래스들을 함께 동작시킨다. Utility 기존 클래스를 사용하고 싶은데 인터페이스가 맞지 않을 때 이미 만든 것을 재사용하고자 하나 이 재사용 가...</p></div></div></a></div><div class="card"> <a href="/posts/design_patterns-bridge/"><div class="card-body"> <em class="timeago small" data-ts="1586949600" > 2020-04-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Design Patterns - Bridge</h3><div class="text-muted small"><p> Structural Patterns - Bridge Intent 구현에서 추상을 분리하여, 이들이 독립적으로 다야엉을 가질 수 있도록 한다. 핸들(Hanle), 구현부(Body) 라고도 불린다. Utility 추상적 새념과 이에 대한 구현 사잉의 지속적인 종속 관계를 피하고 싶을 때 런타일에 구현 방법을 선택하거나 구현 내용을...</p></div></div></a></div><div class="card"> <a href="/posts/design_patterns-composite/"><div class="card-body"> <em class="timeago small" data-ts="1586955900" > 2020-04-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Design Patterns - Composite</h3><div class="text-muted small"><p> Structural Patterns - Composite Intent 부분과 전체의 계층을 표현하기 위해 객체들을 모아 트리 구조로 구성한다. 사용자로 하여금 개별 객체와 복합 객체를 모두 동일하게 두룰수 있게 한다. Utility 부분-전체의 객체 계통을 표현하고 싶을 때 사용자가 객체의 합성으로 생긴 복합 객체와 개개의 객...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/design_patterns-facade/" class="btn btn-outline-primary" prompt="Older"><p>Design Patterns - Facade</p></a> <a href="/posts/design_patterns-proxy/" class="btn btn-outline-primary" prompt="Newer"><p>Design Patterns - Proxy</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/ISSuh">ISSuh</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-157715138-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-157715138-1'); }); </script>

<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Effective C++ - Item.4" /><meta property="og:locale" content="en" /><meta name="description" content="객체를 사용하기 전에 반드시 그 객체를 초기화하자" /><meta property="og:description" content="객체를 사용하기 전에 반드시 그 객체를 초기화하자" /><link rel="canonical" href="https://issuh.github.io/posts/effective_c++_item_4/" /><meta property="og:url" content="https://issuh.github.io/posts/effective_c++_item_4/" /><meta property="og:site_name" content="My Technical Diary" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-30T22:15:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Effective C++ - Item.4" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-04-30T22:15:00+09:00","datePublished":"2020-04-30T22:15:00+09:00","description":"객체를 사용하기 전에 반드시 그 객체를 초기화하자","headline":"Effective C++ - Item.4","mainEntityOfPage":{"@type":"WebPage","@id":"https://issuh.github.io/posts/effective_c++_item_4/"},"url":"https://issuh.github.io/posts/effective_c++_item_4/"}</script><title>Effective C++ - Item.4 | My Technical Diary</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="My Technical Diary"><meta name="application-name" content="My Technical Diary"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profile.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">My Technical Diary</a></div><div class="site-subtitle font-italic">ISSuh's tech blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/aboutme/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ISSuh" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yoyus5','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Effective C++ - Item.4</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Effective C++ - Item.4</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/ISSuh">ISSuh</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1588252500" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-04-30 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3976 words"> <em>22 min</em> read</span></div></div></div><div class="post-content"><h1 id="객체를-사용하기-전에-반드시-그-객체를-초기화하자">객체를 사용하기 전에 반드시 그 객체를 초기화하자</h1><hr /><h2 id="내용"><span class="mr-2">내용</span><a href="#내용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="객체의-초기화"><span class="mr-2">객체의 초기화</span><a href="#객체의-초기화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>초기화되지 않은 값을 읽도록 내버려 두면 정의되지 않은 동작이 그대로 흘러 나오게 된다. 일반적인 경우에 적당히 무작위 비트의 값을 읽고 객체의 내부가 이상한 값을 가지게 된다.</p><h3 id="c에서-객체의-초기화-보장-유무"><span class="mr-2">C++에서 객체의 초기화 보장 유무</span><a href="#c에서-객체의-초기화-보장-유무" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>C++의 객체(변수) 초기화가 중구난방인 것은 절대 아니다. 언제 초기화가 보장되며 언제 그렇지 않은지에 대한 규칙이 명확하게 정의되어 있다. 다만 한가지 안타까운 점은, 규칙 자체가 아주 복합하다는 것이다.</p><p>일반적인 사항부터 확일해보면, C++의 C 부분만을 쓰고 있으며 초기화에 런타임 비용이 소모될 수 있는 상황이라면 값이 초기화 된다는 보장이 없다. 그렇지만 C가 아닌 부분으로 진입하게 되면 사정이 때떄로 달라지게 된다. 배열(C++의 C부분)은 각 원소가 확실히 초기화 된다는 보장이 없으나, vector(C++의 STL부분)는 그러한 보장을 가지게 되는 이유가 바로 이런 법칙 때문이다.</p><p>가장 좋은 방법은 모든 객체를 사용하기 전에 <strong>항상</strong> 초기화 하는 것이다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                          <span class="c1">// int의 직접 초기화</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text</span> <span class="o">=</span> <span class="s">"Hello World!"</span><span class="p">;</span>  <span class="c1">// 포인터의 직접 초기화</span>

<span class="kt">double</span> <span class="n">d</span><span class="p">;</span>                           <span class="c1">// 입력 스트림을 통한 초기화 수행</span>
<span class="n">std</span><span class="o">::</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">d</span><span class="p">;</span>
</pre></table></code></div></div><h3 id="클래스-생성자에서의-초기화"><span class="mr-2">클래스 생성자에서의 초기화</span><a href="#클래스-생성자에서의-초기화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>위와 같은 변수의 초기화 부분을 제외하면, C++의 초기화의 나머지 부분은 생성자로 귀결된다.</p><p>생성자에서 지킬 규칙은 “<em>객체의 모든 것을 초기화 한다</em>” 라는 것만 지키면 된다는 것을 기억하자. 다만, 한가지 주의할 점은 <em>대입(assignment)</em>을 <em>초기화(initialization)</em>으로 착각하지 않는 다는 것이 가장 중요하다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">PhoneNumber</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="k">class</span> <span class="nc">ABEntry</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">ABEntry</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span>
          <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">address</span><span class="p">,</span>
          <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;&amp;</span> <span class="n">phones</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 아래와 같은 코드는 "초기화"가 아닌 "대입" 이다</span>
    <span class="n">theName</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">theAddress</span> <span class="o">=</span> <span class="n">address</span><span class="p">;</span>
    <span class="n">thePhones</span> <span class="o">=</span> <span class="n">phones</span><span class="p">;</span>
    <span class="n">numTimesConsulted</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

<span class="nl">private:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">theName</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">theAddress</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;</span> <span class="n">thePhones</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">numTimesConsulted</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>위의 예제와 같은 경우, ABEntry 객체는 원하는 값을 가지게 되지만, 그 내부를 확인해 보면 생성자에서 각 멤버변수에 대한 초기화가 진행되는 것이 아닌 대입을 하고 있다. 즉, theName, theAddress, thePhones 멤버 변수의 경우, 생성자에서 초기화 되는 것이 아니라 어떤 값이 대입됨으로써 ABEntry 생성자에 진입하기도 전에 이들 세 데이터 멤버 변수의 기본 생성자가 호출되어 진다. 다만 numTimesConsulted 멤버 변수의 경우 기본 데이터 타입인 int이므로, 생성자에서 대입되기 전에 초기화 되리란 보장이 없다.</p><p>위와같이 생성자에서 <em>대입</em> 대신 <em>초기화</em>를 하기 위해서는 <em>멤버 초기화 리스트</em>를 사용하면 된다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">PhoneNumber</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="k">class</span> <span class="nc">ABEntry</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">ABEntry</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span>
          <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">address</span><span class="p">,</span>
          <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;&amp;</span> <span class="n">phones</span><span class="p">)</span> <span class="o">:</span> 
            <span class="n">theName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>           <span class="c1">// 대입이 아닌 초기화를 한다</span>
            <span class="n">theAddress</span><span class="p">(</span><span class="n">address</span><span class="p">),</span>
            <span class="n">thePhones</span><span class="p">(</span><span class="n">phones</span><span class="p">),</span>
            <span class="n">numTimesConsulted</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// 생성자 본문은 비어있다</span>

<span class="nl">private:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">theName</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">theAddress</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;</span> <span class="n">thePhones</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">numTimesConsulted</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>멤버 변수에 사용자가 원하는 값을 주고 시작한다는 점에서는 동일하지만, 위의 생성자(초기화)에서는 먼저 정의한 생성자(대입)보다 효율적일 가능성이 크다.</p><p>대입만 사용한 버전의 경우 theName, theAddress, thePhones 멤버 변수에 대해 기본 생성자를 호출해서 초기화를 미리 해 놓은 후에 생성자에서 곧바로 새로운 값을 대입하고 있다. 따라서 먼저 호출된 각 멤버 변수의 기본 생성자에서 해 놓은 초기화는 아깝게도 그냥 헛짓이 되어 버리고 만다.</p><p>이러한 문제는 멤버 초기화 리스트를 통해 피해갈 수 있다. 초기화 리스트에 들어가는 인자는 바로 멤버 변수에 대한 생성자의 인자로 쓰이기 때문이다. 두번째의 초기화 버전의 생성자의 경우, theName은 name으로 부터 복사 생성자에 의해 초기화 고, theAddress는 address으로 부터 복사 생성자에 의해 초기화되며, thePhones도 동일하게 phones로 부터 초기화 된다.</p><p>대부분의 데이터 타입에 대해서는, 기본 생성자 호출 후에 복사 대입 연산자를 연달아 호출하는 이전의 방법보다 복사 생성자를 한 번 호출하는 쪽이 더 효율적이다.</p><p>기본제공 타입의 객체는 초기화와 대입에 걸리는 비용의 차이가 없지만, 역시 멤버 초기화 리스트에 모두 넣어 주는 쪽이 바람직하다. 또 멤버 변수를 기본 생성자로 초기화 하고 싶을 때도 멤버 초기화 리스트를 사용하는 습관을 들이는 것이 좋다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">ABEntry</span><span class="o">::</span><span class="n">ABEntry</span><span class="p">()</span> <span class="o">:</span>
  <span class="n">theName</span><span class="p">(),</span>
  <span class="n">theAddress</span><span class="p">(),</span>
  <span class="n">thePhones</span><span class="p">(),</span>
  <span class="n">numTimesConsulted</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
</pre></table></code></div></div><p>기본제공 타입의 멤버를 초기화 리스트로 넣는 일이 선택이 아니라 <em>의무</em>가 될 때도 있다. 바로 멤버 변수가 상수 이거나 참조자로 되어있을 때 이다. 이는 상수와 참조자는 대입 자체가 불가능하기 때문에 반드시 초기화 리스트를 통해 초기화 되어야 한다.</p><h3 id="객체를-구성하는-데이터의-초기화-순서"><span class="mr-2">객체를 구성하는 데이터의 초기화 순서</span><a href="#객체를-구성하는-데이터의-초기화-순서" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>객체를 구성하는 데이터의 초기화 순서는 어떤 컴파일러를 막론하고 항상 똑같다.</p><ul><li>기본 클래스는 파생 클래스보다 먼저 초기화 된다.<li>클래스 멤버 변수는 그들이 선언된 순서대로 초기화 된다.</ul><p>위의 ABEntry 클래스를 예로들면, theName이 항상 첫 번째로 초기화 되고, theAddress가 두번째, thePhones 세번째, numTimesConsulted가 마지막으로 초기화 된다. 즉, 선언된 순서대로 초기화 된다. 만약 어쩌다 멤버 초기화 리스트에 이들이 넣어진 순서가 다르더라도(이러한 경우 컴파일은 가능하다) 초기화 순서는 그대로 이다.</p><h3 id="비지역-정적-객체의-초기화-순서는-개별-번역-단위에서-정해진다"><span class="mr-2">비지역 정적 객체의 초기화 순서는 개별 번역 단위에서 정해진다</span><a href="#비지역-정적-객체의-초기화-순서는-개별-번역-단위에서-정해진다" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>정적 객체(static object)</strong> 는 자신이 생성된 시점부터 프로그램이 끝날 떄 까지 살아 있는 객체를 일컫는다. 즉, 스택 객체 및 힙 기반 객체는 애초부터 정적 객체가 될 수 없다.</p><p>정적 객체의 범주에 들어가는 것들은 아래와 같다.</p><ul><li><em>전역 객체</em><li><em>네입스페이스 유효범위에서 정의된 객체</em><li><em>클래스 안에서 static으로 정의된 객체</em><li><em>함수 안에서 static으로 정의된 객체</em><li><em>파일 유효범위에서 static으로 정의된 객체</em></ul><p>이중 함수 안에 있는 정적 객체는 함수에 대해서 지역성을 가지고 있으므로 <strong>지역 정적 객체(local static object)</strong> 이라 하고, 나머지 정적 객체 들은 <strong>비지역 정적 객체(non local static object)</strong> 라고도 불린다.</p><p>이러한 다섯가지의 정적 객체들은 프로그램이 끝날 때 자동으로 소멸된다. 다시 말해, main() 함수의 실행이 끝날 때 정적 객체의 소멸자가 호출된다.</p><p><em>비지역 정적 객체</em>의 초기화 순서 문제의 시작은 컴파일에서 부터 시작된다.</p><p><strong>번역 단위(translation unit)</strong> 는 컴파일을 통해 하나의 목적 파일(object file)을 만드는 바탕이 되는 소스 코드를 일컫는다. 여기서 번역은 소스의 언어를 기계어로 옮긴다는 의미이다. 기본적으로는 소스 파일 하나가 되는데, 그 파일이 #include하는 파일들까지 합쳐서 하나의 번역 단위가 된다.</p><p>별도로 컴파일된 소스 파일이 두 개 이상 있으며 각 소스 파일에 <em>비지역 정적 객체(전역 객체, 네임스페이스에 있는 객체, 클래스 혹은 파일에 있는 정적 객체)</em> 가 한개 이상 들어 있는 경우에 문제가 발생한다. 실질적인 문제는 한쪽 번역 단위에 있는 <em>비지역 정적 객체</em>의 초기화가 진행되면서 다른 쪽 번역 단위에 있는 <em>비지역 정적 객체</em>가 사용되는데, 불행히도 다른 쪽 번역 단위에 있는 객체가 초기화되어 있지 않을 지도 모른다는 점이다. 이유는 <strong>별개의 번역 단위에서 정의된 <em>비지역 정적 객체</em>들의 순서는 ‘정해져 있지 않다’</strong> 라는 사실 때문이다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// 사용자가 사용하는 라이브러리에 포함된 클래스</span>
<span class="k">class</span> <span class="nc">FileSystem</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="c1">// 멤버 함수들 </span>

  <span class="p">...</span>

  <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">numDisks</span><span class="p">()</span> <span class="k">const</span><span class="p">();</span>

  <span class="p">...</span>

<span class="p">};</span>

<span class="c1">// 사용자가 쓰게 될 객체</span>
<span class="k">extern</span> <span class="n">FileSystem</span> <span class="n">tfs</span><span class="p">;</span>
</pre></table></code></div></div><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">// 사용자가 정의한 클래스</span>
<span class="k">class</span> <span class="nc">Direcotry</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">Direcotry</span><span class="p">(</span> <span class="n">params</span> <span class="p">)</span> <span class="p">{</span>

    <span class="p">...</span>

    <span class="c1">// 외부 파일에 정의한 tfs 객체를 사용</span>
    <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">disks</span> <span class="o">=</span> <span class="n">tfs</span><span class="p">.</span><span class="n">numDisks</span><span class="p">();</span>

    <span class="p">...</span>

  <span class="p">}</span>

  <span class="p">...</span>

<span class="p">};</span>

<span class="p">...</span>

<span class="c1">// 임시 파일을 담는 디렉토리</span>
<span class="n">Direcotry</span> <span class="nf">tempDir</span><span class="p">(</span> <span class="n">params</span> <span class="p">);</span>

</pre></table></code></div></div><p>위의 예제에서, 정적 객체의 초기화 순서 때문에 문제가 심각해질 수도 있는 상황이 들어났다. tfs가 tempDir보다 먼저 초기화 되지 않으면, tempDir의 생성자는 tfs가 초기화되지도 않았는데 tfs를 사용하려고 할 것이다. 그러나 tfs와 temDir은 제작자도, 만들어진 시기도, 소스파일 또한 다르다. 즉, 이들은 다른 <em>번역 단위</em> 안에서 정의된 <em>비지역 정적 객체</em> 이다.</p><p>tempDir 전에 tfs가 초기화되게 만들고 싶을때, 이 목표를 어떻게 달성할 것인가. 결론부터 이야기 하자면 불가능 하다. <strong>서로 다른 번역 단위에 정의된 <em>비지역 정적 객체</em>들 사이의 상대적인 초기화 순서는 정해져 있지 않기</strong> 때문이다.</p><p>위의 문제를 해결하는 방법은 초기화 순서 문제를 사전에 봉쇄하는 것이다. <em>비지역 정적 객체</em>를 하나씩 맡는 함수를 준비하고 이 안에 객체를 넣는 방법이다. 함수 속에서도 이들은 정적 객체로 선어하고, 그 함수에서는 이들에 대한 참조자를 반환하는 것이다. 사용자 쪽에서는 <em>비지역 정적 객체</em>를 직접 참조하는 것이 아닌 함수 호출로 참조하도록 하는 것이다. 즉, <em>비지역 정적 객체</em>를 <em>지역 정적 객체</em>로 바꾸는 것이다. 이는 디자인 패턴중 <em>Singleton Pattern</em>의 전형적인 구현양식과 동일하다.</p><p><em>지역 정적 객체</em>는 함수 호출중에 그 객체의 정의에 최초로 닿았을 때 초기화되도록 만들어져 있다. 이는 C++에서 보장하는 사실이며, 위의 방법은 그 사실을 이용한 방법이다. 따라서 <em>비지역 정적 객체</em>를 직접 접근하지 않고 <em>지역 정적 객체</em>에 대한 참조자를 반환하는 쪽으로 바꾸었다면, 얻어낸 참조자는 반드시 초기화된 객체를 참조하도록 맞춰주어야 한다.</p><p><em>비지역 정적 객체</em> 대신에 준비한 ‘<em>지역 객체 참조자 반환</em>’ 함수를 호출할 일이 없다면 해당 객체의 생성/소멸 비용도 생기지 않도록 막아야 한다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// 이전과 같은 클래스</span>
<span class="k">class</span> <span class="nc">FileSystem</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="c1">// tfs 객체를 함수로 대체한다</span>
<span class="c1">// 이 함수는 클래스안에 정적 멤버로 들어가도 된다</span>
<span class="n">FileSystem</span><span class="o">&amp;</span> <span class="n">tfs</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 지역 정적 객체를 정의하고 초기화</span>
  <span class="k">static</span> <span class="n">FileSystem</span> <span class="n">fs</span><span class="p">;</span>

  <span class="c1">// 이 객체에 대한 참조자를 반환</span>
  <span class="k">return</span> <span class="n">fs</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">// 이전과 같은 클래스</span>
<span class="c1">// 다만 tfs가 함수로 바뀌었으므로 이제는 함수호출로 바뀜</span>
<span class="k">class</span> <span class="nc">Direcotry</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="c1">// tempDir 객체를 함수로 대체한다</span>
<span class="c1">// 이 함수는 클래스안에 정적 멤버로 들어가도 된다</span>
<span class="n">Direcotry</span><span class="o">&amp;</span> <span class="n">tempDir</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 지역 정적 객체를 정의하고 초기화</span>
  <span class="k">static</span> <span class="n">Directory</span> <span class="n">td</span><span class="p">;</span>

  <span class="c1">// 이 객체에 대한 참조자를 반환</span>
  <span class="k">return</span> <span class="n">td</span><span class="p">;</span>
<span class="p">};</span>

</pre></table></code></div></div><p>위의 경우에 대한 문제점을 생각했을 때, 참조자 반환 함수는 내부적으로 정적 객체를 쓰기 때문에, 다중스레드 시스템에서는 동작에 장애가 생길 수도 있다. 다중스레드 시스템상에서는 <em>비상수 정적 객체(지역 객체이든 비지역 객체이든)</em> 은 온갖 문제를 발생 시킬수 있다. 이 문제를 다루기 위한 한가지 방법으로 프로그램이 다중스레드로 돌입하기 전의 시동 단계에서 참조자 반환 함수를 전부 직접 호출해 줄 수 있다. 이렇게 하면 초기화에 관계된 <em>경쟁 상태(race condition)</em> 가 없어지게 된다.</p><p>물론 초기화 순서 문제를 방지하기 위해 이처럼 참조자 반환 함수를 사용하는 아이디어는 객체들의 초기화 순서를 제대호 맞춰 둔자는 전제조건이 뒷바침되어야 한다. 이를테면 객체 B가 초기화되기 전에 객체 A가 초기화 되어야 하는데, A의 초기화가 B의 초기화에 의족하도록 되어 있다면 이는 제대로 동작하지 않을 것이다.</p><h2 id="요점"><span class="mr-2">요점</span><a href="#요점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>기본제공 타입의 객체는 경우에 따라 저절로 되기도 하고 안되기도 하기 때문에 직접 초기화한다.</p></blockquote><blockquote><p>셍성자에서는, 데이터 멤버에 대한 대입문을 생성자 본문 내부에 넣는 방법으로 멤버를 초기화 하지 말고 멤버 초기화 리스트를 사용한다.</p></blockquote><blockquote><p>초기화 리스트에 데이터 멤버를 나열할 때는 클래스에 각 데이터 멤버가 선언된 순서와 똑같이 나열한다.</p></blockquote><blockquote><p>여러 번역 단위에 있는 비지역 정적 객체들의 초기화 순서 문제는 피해서 설계해야 한다.</p></blockquote><blockquote><p>비지역 정적 객체를 지역 정적 객체로 바꾼다.</p></blockquote><hr /><hr /><p><em>참고</em>. Effective C++ 3/E - Scott Meyers</p><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/c/'>C++</a>, <a href='/categories/effective-c/'>Effective C++</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >C++</a> <a href="/tags/effective-c/" class="post-tag no-text-decoration" >Effective C++</a> <a href="/tags/initial/" class="post-tag no-text-decoration" >Initial</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Effective C++ - Item.4 - My Technical Diary&amp;url=https://issuh.github.io/posts/effective_c++_item_4/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Effective C++ - Item.4 - My Technical Diary&amp;u=https://issuh.github.io/posts/effective_c++_item_4/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://issuh.github.io/posts/effective_c++_item_4/&amp;text=Effective C++ - Item.4 - My Technical Diary" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/educative-distributed-system-10/">Distributed Systems - Coordination Patterns</a><li><a href="/posts/educative-distributed-system-04/">Distributed Systems - CAP</a><li><a href="/posts/educative-distributed-system-03/">Distributed Systems - Replication</a><li><a href="/posts/my_project_simpledb/">simpleDB - 메모리</a><li><a href="/posts/ps-hackerrank-01/">HackerRandk - Fraudulent Activity Notifications</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/effective_c++_item_1/"><div class="card-body"> <em class="timeago small" data-ts="1586535060" > 2020-04-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Effective C++ - Item.1</h3><div class="text-muted small"><p> C++를 언어들의 연합체로 바라보는 안목은 필수 오늘날의 C++는 다중패러다임 프로그래밍 언어(Multiparadigm Programming Language) 라고 불리운다. 절차적(Procedural) 프로그래밍 을 기본으로 하여 객체 지향(Object Oriented) , 함수식(Functional) , 일반화(Generic) 프로그래밍을 포함...</p></div></div></a></div><div class="card"> <a href="/posts/effective_c++_item_2/"><div class="card-body"> <em class="timeago small" data-ts="1586538180" > 2020-04-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Effective C++ - Item.2</h3><div class="text-muted small"><p> #define을 쓰려거든 const, enum, inline을 떠올리자 가급적 전처리기(Preprocessor) 보다 컴파일러를 가까이 하자   #define의 경우 전처리기에서 이미 치환시켜 값을 대입하기 때문에 컴파일러가 쓰는 기호 테이블에 값이 들어가지 않는다. 따라서 숫자 상수로 대체된 코드에서 컴파일 에러가 발생한다면 이를 디버깅하...</p></div></div></a></div><div class="card"> <a href="/posts/effective_c++_item_3/"><div class="card-body"> <em class="timeago small" data-ts="1588245780" > 2020-04-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Effective C++ - Item.3</h3><div class="text-muted small"><p> 낌새만 보이면 const를 들이대 보자! 내용 Const 키워드 const의 가장 눈에 띄는 특징이라면, const가 붙은 객체는 외부 변경을 불가능 하게 한다라는 ‘의미적인 제약’을 소스코드 수준에서 행해진다는 점과 컴파일러가 이 제약을 단단히 지켜준다는 점이다. const 키워드는 클래스 바깥에서 전역 혹은 네임스페이스 유효범위의 상수를...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/effective_c++_item_3/" class="btn btn-outline-primary" prompt="Older"><p>Effective C++ - Item.3</p></a> <a href="/posts/ps-leetcode-849/" class="btn btn-outline-primary" prompt="Newer"><p>LeetCode - 849. Maximize Distance to Closest Person</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/ISSuh">ISSuh</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-157715138-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-157715138-1'); }); </script>

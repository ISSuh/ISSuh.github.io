<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="JPA - 연관관계 매핑" /><meta property="og:locale" content="en" /><meta name="description" content="연관관계가 필요한 이유" /><meta property="og:description" content="연관관계가 필요한 이유" /><link rel="canonical" href="https://issuh.github.io/posts/spring-jpa-03/" /><meta property="og:url" content="https://issuh.github.io/posts/spring-jpa-03/" /><meta property="og:site_name" content="My Technical Diary" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-10-24T10:30:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JPA - 연관관계 매핑" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-04-23T22:54:02+09:00","datePublished":"2023-10-24T10:30:00+09:00","description":"연관관계가 필요한 이유","headline":"JPA - 연관관계 매핑","mainEntityOfPage":{"@type":"WebPage","@id":"https://issuh.github.io/posts/spring-jpa-03/"},"url":"https://issuh.github.io/posts/spring-jpa-03/"}</script><title>JPA - 연관관계 매핑 | My Technical Diary</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="My Technical Diary"><meta name="application-name" content="My Technical Diary"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profile.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">My Technical Diary</a></div><div class="site-subtitle font-italic">ISSuh's tech blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/aboutme/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ISSuh" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yoyus5','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JPA - 연관관계 매핑</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>JPA - 연관관계 매핑</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/ISSuh">ISSuh</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1698111000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-10-24 </em> </span> <span> Updated <em class="timeago" data-ts="1713880442" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-04-23 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1770 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><h3 id="연관관계가-필요한-이유"><span class="mr-2">연관관계가 필요한 이유</span><a href="#연관관계가-필요한-이유" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>객체를 테이블에 맞추어 데이터 중심으로 모델링 하면, 협력관계를 만들 수 없음</p><ul><li><strong>데이블은 외래키로 조인</strong>을 사용해서 연관된 테이블을 찾음<li><strong>객체는 참조</strong>를 사ㅇ해서 연관된 객체를 찾음<li>데이블과 객체 사이에는 이런 큰 간격이 존재 함</ul><h3 id="단방향-연관관계"><span class="mr-2">단방향 연관관계</span><a href="#단방향-연관관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>어느 한쪽만이 다른쪽을 소유하고 있는 관계. 객체의 참조와 테이블의 외래키를 매핑.</p><p><img data-src="/assets/posts/img/spring/spring_jpa_1/spring_jpa_03_01.png" alt="Alt text" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Team</span> <span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"TEAM_ID"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"MEMBER_ID"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"USERNAME"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="c1">// 객체의 참조와 테이블의 FK를 매핑</span>
  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"TEAM_ID"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Team</span> <span class="n">team</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p><img data-src="/assets/posts/img/spring/spring_jpa_1/spring_jpa_03_02.png" alt="Alt text" data-proofer-ignore></p><h3 id="양방향-연관관계"><span class="mr-2">양방향 연관관계</span><a href="#양방향-연관관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>어느 한쪽만이 다른쪽을 소유하고 있는 관계가 아닌 서로 참조하는 관계</p><p><img data-src="/assets/posts/img/spring/spring_jpa_1/spring_jpa_03_03.png" alt="Alt text" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Team</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"TEAM_ID"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"team"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"MEMBER_ID"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"USERNAME"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"TEAM_ID"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Team</span> <span class="n">team</span><span class="o">;</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">//조회</span>
<span class="nc">Team</span> <span class="n">findTeam</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Team</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">team</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="kt">int</span> <span class="n">memberSize</span> <span class="o">=</span> <span class="n">findTeam</span><span class="o">.</span><span class="na">getMembers</span><span class="o">().</span><span class="na">size</span><span class="o">();</span> <span class="c1">//역방향 조회</span>
</pre></table></code></div></div><h3 id="양방향-연관관계-1"><span class="mr-2">양방향 연관관계</span><a href="#양방향-연관관계-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="객체와-테이블이-관계를-맺는-차이"><span class="mr-2">객체와 테이블이 관계를 맺는 차이</span><a href="#객체와-테이블이-관계를-맺는-차이" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>테이블의 경우, 외래키로 두 테이블이 묶여 있을 떄 해당 외래키를 이용 하여 조인하면 값을 확인할 수 있음. 즉, 테이블은 방향이라는 개념이 따로 없으며 굳이 정하자면 외래키를 통하여 서로간 양방향 관계라고 볼 수 있음.</p><p>그러나 객체 참조의 경우 클래스의 필드에 타 클래스의 참조가 존재하지 않는한 참조관계가 성립되지 않고, 참조하고 있는 클래스만이 단방향으로 관계를 맺고 있음. 즉, 참조에서 양방향관계를 맺기 위해선 서로간 참조를 실제로 소유하고 있어야 함. 그러므로 양방향 관계라고 하더라도 사실상 단방향 관계가 두개가 있는 형상임</p><ul><li>객체가 양방향 연관관계 일때의 세부 연관관계 = 2개<ul><li>회원 -&gt; 팀 연관관계 1개(단방향)<li>팀 -&gt; 회원 연관관계 1개(단방향)</ul><li>테이블 양방향 연관관계 일때의 세부 연관관계 = 1개<ul><li>회원 &lt;-&gt; 팀의 연관관계 1개(양방향)</ul></ul><p><img data-src="/assets/posts/img/spring/spring_jpa_1/spring_jpa_03_03.png" alt="Alt text" data-proofer-ignore></p><h5 id="객체의-양방향-관계"><span class="mr-2">객체의 양방향 관계</span><a href="#객체의-양방향-관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><ul><li>객체의 <strong>양방향 관계는 사싱 양방향 관계가 아니라 서로다른 2개의 단방향 관계</strong>의 조합 임<li>객체를 양방향으로 참조하려면 <strong>단방향 연관관계를 2개</strong> 만들어야함</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
  <span class="no">B</span> <span class="n">b</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="o">{</span>
  <span class="no">A</span> <span class="n">a</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><h5 id="테이블의-양방향-관계"><span class="mr-2">테이블의 양방향 관계</span><a href="#테이블의-양방향-관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><ul><li>테이블은 <strong>외래 키 하나</strong>로 두 테이블의 연관관계를 관리<li>외래키 하나로 인하여 양방향 연관관계를 가짐</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1">-- MEMBER.TEAM_ID 외래키 하나로 양방향 연관관계를 가짐</span>
<span class="c1">-- (양쪽으로 조인할 수 있음)</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">MEMBER</span> <span class="n">M</span>
<span class="k">JOIN</span> <span class="n">TEAM</span> <span class="n">T</span> <span class="k">ON</span> <span class="n">M</span><span class="p">.</span><span class="n">TEAM_ID</span> <span class="o">=</span> <span class="n">T</span><span class="p">.</span><span class="n">TEAM_ID</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">TEAM</span> <span class="n">T</span>
<span class="k">JOIN</span> <span class="n">MEMBER</span> <span class="n">M</span> <span class="k">ON</span> <span class="n">T</span><span class="p">.</span><span class="n">TEAM_ID</span> <span class="o">=</span> <span class="n">M</span><span class="p">.</span><span class="n">TEAM_ID</span>
</pre></table></code></div></div><h4 id="연관관계의-주인"><span class="mr-2">연관관계의 주인</span><a href="#연관관계의-주인" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>결국 객체에선 양방향 관계에선 결국 2개의 단방향 관계가 성립되므로 어느 한쪽이 외래키를 매핑하여 관리할 것인지 지정해 주어야 함</p><p><img data-src="/assets/posts/img/spring/spring_jpa_1/spring_jpa_03_04.png" alt="Alt text" data-proofer-ignore></p><h5 id="양방향-매핑-규칙"><span class="mr-2">양방향 매핑 규칙</span><a href="#양방향-매핑-규칙" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><ul><li>객체의 두 관계중 하나를 연관관계의 주인으로 지정<li><strong>연관관예의 주인만이 외래 키를 관리(등록, 수정)</strong><li><strong>주인이 아닌 쪽은 읽기만 가능</strong><li>주인은 mappedBy 속성을 사용하면 안됨<li>주인이 아니면 mappedBy 속성을 사용하여 주인을 지정해야 함</ul><h5 id="주인-선정-기준"><span class="mr-2">주인 선정 기준</span><a href="#주인-선정-기준" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><ul><li><strong>외래키가 있는 곳을 주인으로 선택하는 방법이 좋음</strong><li>아래 그림의 예에선 Member.team이 연관관계의 주인으로 선정</ul><p><img data-src="/assets/posts/img/spring/spring_jpa_1/spring_jpa_03_05.png" alt="Alt text" data-proofer-ignore></p><h4 id="양방향-연관관계에서의-주의점"><span class="mr-2">양방향 연관관계에서의 주의점</span><a href="#양방향-연관관계에서의-주의점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><h5 id="연관관계의-주인에-값을-입력하지-않는-경우"><span class="mr-2">연관관계의 주인에 값을 입력하지 않는 경우</span><a href="#연관관계의-주인에-값을-입력하지-않는-경우" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nc">Team</span> <span class="n">team</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Team</span><span class="o">();</span>
<span class="n">team</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"TeamA"</span><span class="o">);</span>
<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">team</span><span class="o">);</span>

<span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
<span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"member1"</span><span class="o">);</span>

<span class="c1">//역방향(주인이 아닌 방향)만 연관관계 설정</span>
<span class="n">team</span><span class="o">.</span><span class="na">getMembers</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
</pre></table></code></div></div><h5 id="양방향-매핑시-연관관계의-주인에-값을-입력해야함"><span class="mr-2">양방향 매핑시 연관관계의 주인에 값을 입력해야함</span><a href="#양방향-매핑시-연관관계의-주인에-값을-입력해야함" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nc">Team</span> <span class="n">team</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Team</span><span class="o">();</span>
<span class="n">team</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"TeamA"</span><span class="o">);</span>
<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">team</span><span class="o">);</span>

<span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
<span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"member1"</span><span class="o">);</span>

<span class="n">team</span><span class="o">.</span><span class="na">getMembers</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

<span class="c1">//연관관계의 주인에 값 설정</span>
<span class="n">member</span><span class="o">.</span><span class="na">setTeam</span><span class="o">(</span><span class="n">team</span><span class="o">);</span>

<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
</pre></table></code></div></div><ul><li>commit() 시점에 실제 쿼리가 적용되고 이전에는 영속성 컨텍스트의 1차 캐시에만 객체가 저장되어 있는 상태<li>해당 상황에서 연관관계의 주인에만 값을 설정하게 되면 flush(), clear()와 같이 바로 쿼리를 적용하지 않는이상 하나의 트랜잭션 내에서 주인이 아닌 쪽에는 값이 설정되지 않은 상태가 됨</ul><h5 id="주의점-정리"><span class="mr-2">주의점 정리</span><a href="#주의점-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><ul><li><strong>순수 객체 상태를 고려하여 항상 양쪽에 값을 설정해야 함</strong><li>연관관계 편의 메소드를 생성하도록 함<li>양방향 매핑시에 무한루프를 조심해야 함<ul><li>예) toString(), lombok, JSON 생성 라이브러리</ul></ul><blockquote><p><strong>Controller 에서 Entity를 바로 반환하지 않도록 해야 함</strong> Controller 에서 Entity를 바로 반환시 JSON 으로 변환하는 과정에서 무한루프에 빠질수 있으며, 무엇보다 Entity 수정시 API 도한 수정이 발생하여 정합을 다시 해야하는 문제가 발생함. 그러므로 되도록이면 Entity를 바로 반환하는 것이 아닌 단순 데이터가 있는 DTO로 변환하여 반환하는것이 좋음.</p></blockquote><h4 id="양방향-매핑-정리"><span class="mr-2">양방향 매핑 정리</span><a href="#양방향-매핑-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li><strong>단방향 매핑만으로도 이미 연관관계 매핑을 완료</strong><ul><li>되도록이면 양방향 매핑을 피하는 설계가 좋음</ul><li>양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가된 것 뿐<li>JPQL에서 영방향으로 탐색할 일이 많음<li>단방향 매핑을 잘 하고 양방향은 필요할 떄 추가해도 됨(테이블에 영향을 주지 않음)<li>비지니스 로직을 기준으로 연관관계의 주인을 선택하는 것이 아닌 <strong>외래키의 위치를 기준으로 연관관계의 주인을 정해야 함</strong></ul><hr /><p>참고</p><ul><li>자바 ORM 표준 JPA 프로그래밍(김영한)</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/jpa/'>JPA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >Web</a> <a href="/tags/spring-framework/" class="post-tag no-text-decoration" >Spring Framework</a> <a href="/tags/database/" class="post-tag no-text-decoration" >DataBase</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >JPA</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JPA - 연관관계 매핑 - My Technical Diary&amp;url=https://issuh.github.io/posts/spring-jpa-03/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JPA - 연관관계 매핑 - My Technical Diary&amp;u=https://issuh.github.io/posts/spring-jpa-03/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://issuh.github.io/posts/spring-jpa-03/&amp;text=JPA - 연관관계 매핑 - My Technical Diary" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/educative-distributed-system-10/">Distributed Systems - Coordination Patterns</a><li><a href="/posts/educative-distributed-system-04/">Distributed Systems - CAP</a><li><a href="/posts/educative-distributed-system-03/">Distributed Systems - Replication</a><li><a href="/posts/my_project_simpledb/">simpleDB - 메모리</a><li><a href="/posts/ps-hackerrank-01/">HackerRandk - Fraudulent Activity Notifications</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-jpa-01/"><div class="card-body"> <em class="timeago small" data-ts="1698022800" > 2023-10-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA - 영속성 관리</h3><div class="text-muted small"><p> 영속성 컨텍스트 엔티티를 영구 저장하는 환경 영속성 컨텍스트는 눈에 보이지 않는 논리적인 개녕 엔티티 매니저를 통하여 영속성 컨텍스트에 접근 스프링 프레임워크의 컨테이너내에는 엔티티 매니저와 영속성 컨택스트가 N:1 관게로 이루어져 있음 엔티티의 생명주기 비영속(new/transient) 영속(menaged) 준영속(...</p></div></div></a></div><div class="card"> <a href="/posts/spring-jpa-02/"><div class="card-body"> <em class="timeago small" data-ts="1698039000" > 2023-10-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA - 엔티티 매핑</h3><div class="text-muted small"><p> 엔티티 매핑 객체와 테이블 매핑 @Entity, @Table 필드와 컬럼 매핑 @Column 기본 키 매핑 @Id 연관관계 매핑 @ManyToOne, @JoinColumn 객체와 테이블 매핑 @...</p></div></div></a></div><div class="card"> <a href="/posts/spring-jpa-04/"><div class="card-body"> <em class="timeago small" data-ts="1698123600" > 2023-10-24 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA - 다양한 연관관계 매핑</h3><div class="text-muted small"><p> 연관관계 매핑시 고려사항 3가지 다중성 단방향, 양방향 연관관계의 주인 다중성 다대일 : @ManyToOne 일대다 : @OneToMany 일대일 : @OneToOne 다대디 : @ManyToMany 단방향, 양방향 테이블 외래키 하나로 양쪽 조인 가능 사실 방향이라는 개념이...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-mvc-03/" class="btn btn-outline-primary" prompt="Older"><p>Spring MVC - HTTP 요청 기본 기능</p></a> <a href="/posts/spring-jpa-04/" class="btn btn-outline-primary" prompt="Newer"><p>JPA - 다양한 연관관계 매핑</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/ISSuh">ISSuh</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-157715138-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-157715138-1'); }); </script>

<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Spring DB - 트랜잭션 이해" /><meta property="og:locale" content="en" /><meta name="description" content="트랜잭션 데이터를 데이터베이스에 저장하는 대표적인 이유는 데이터베이스가 트랜잭션 이라는 개념을 지원하기 때문" /><meta property="og:description" content="트랜잭션 데이터를 데이터베이스에 저장하는 대표적인 이유는 데이터베이스가 트랜잭션 이라는 개념을 지원하기 때문" /><link rel="canonical" href="https://issuh.github.io/posts/spring-db-03/" /><meta property="og:url" content="https://issuh.github.io/posts/spring-db-03/" /><meta property="og:site_name" content="My Technical Diary" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-10-13T13:10:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring DB - 트랜잭션 이해" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-11-02T12:17:17+09:00","datePublished":"2023-10-13T13:10:00+09:00","description":"트랜잭션 데이터를 데이터베이스에 저장하는 대표적인 이유는 데이터베이스가 트랜잭션 이라는 개념을 지원하기 때문","headline":"Spring DB - 트랜잭션 이해","mainEntityOfPage":{"@type":"WebPage","@id":"https://issuh.github.io/posts/spring-db-03/"},"url":"https://issuh.github.io/posts/spring-db-03/"}</script><title>Spring DB - 트랜잭션 이해 | My Technical Diary</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="My Technical Diary"><meta name="application-name" content="My Technical Diary"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profile.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">My Technical Diary</a></div><div class="site-subtitle font-italic">ISSuh's tech blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/aboutme/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ISSuh" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yoyus5','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Spring DB - 트랜잭션 이해</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring DB - 트랜잭션 이해</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/ISSuh">ISSuh</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1697170200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-10-13 </em> </span> <span> Updated <em class="timeago" data-ts="1698895037" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-11-02 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2187 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h3 id="트랜잭션"><span class="mr-2">트랜잭션</span><a href="#트랜잭션" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>데이터를 데이터베이스에 저장하는 대표적인 이유는 데이터베이스가 트랜잭션 이라는 개념을 지원하기 때문</p><p>트랜잭션이란 데이터베이스에서 하나의 작업을 안전하게 처리하도록 보장해주는 것을 뜻함</p><p>예를 들면, A가 B에게 1000원 계좌이체를 한다고 생각했을떄,</p><ul><li>A의 잔고 1000원 감소<li>B의 잔고 1000원 증가</ul><p>위 두가지 작업이 합쳐 하나의 작업처럼 동작해야 함. 만약 첫번쨰 작업만 성공하고 두번쨰 작업이 실패한다면 A의 잔고만 1000원 감소하는 심각한 문제가 발생하게 돰. 이러한 문제에 대하여 데이터베이스의 트랜잭션은 첫번쨰, 두번째 작업이 둘다 함꼐 성공해야 데이터를 저장하고 중간에 하나라도 실패하면 작업 전의 상태로 되돌아 갈 수 있도록 함 모든 작업이 성공해서 데이터베이스에 정상 반영되는것은 Commit, 작업중 실패하여 이전 상태로 되돌아 가는것을 Rollback 이라고 함</p><h4 id="트랜잭션-acid"><span class="mr-2">트랜잭션 ACID</span><a href="#트랜잭션-acid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>트랜잭션은 원자성(Atomicity), 일관성(Consistency), 격리성(Isolation), 지속성(Durability)를 보장해야 함</p><ul><li>원자성(Atomicity)<ul><li>트랜잭션 내에서 실행한 작업들은 마치 하나의 작업인 것 처럼 모두 성공하거나 모두 실패해야 함</ul><li>일관성(Consistency)<ul><li>모든 트랜잭션은 일관성 있는 데이터베이스 상태를 유지해야 함<li>데이터베이스에서 정한 무결성 제약조건을 항상 만족해야 함</ul><li>격리성(Isolation)<ul><li>동시에 실행되는 트랜잭션들이 서로에게 영향을 미치지 않도록 격리되어야 함<li>동시에 같은 데이터를 수정하지 못하도록 해야 함<li>격리성은 동시성과 관련된 성능이슈로 인하여 트랜잭션의 격리 수준(Isolation Level)을 선탠할 수 있음</ul><li>지속성(Durability)<ul><li>트랜잭션을 성공적으로 끝내며 그 결과가 항상 기록되어야 함<li>중간에 시스템에 문제가 생기더라도 데이터베이스 로그 등을 사용하여 성공한 트랜잭션 내용을 복구 할 수 있어야 함</ul></ul><h4 id="트랜잭션-격리-수준"><span class="mr-2">트랜잭션 격리 수준</span><a href="#트랜잭션-격리-수준" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>Read Uncommited(커밋되지 않은 읽기)<li>Read Commited(커밋된 읽기)<li>Repeatable Read(반복 가능한 읽기)<li>Serializable(직렬화 가능)</ul><p>성능과 데이터의 무결성을 어느정도 타협하여 보통 Read Commited(커밋된 읽기), Repeatable Read(반복 가능한 읽기)을 사용함</p><h4 id="데이터베이스-연결-구조와-db-세션"><span class="mr-2">데이터베이스 연결 구조와 DB 세션</span><a href="#데이터베이스-연결-구조와-db-세션" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_01.png" alt="Alt text" data-proofer-ignore></p><ul><li>사용자는 웹 어플리케이션 서버(WAS)나 데이터베이스 접근 툴과 같은 클라이언트를 사용하여 데이터베이스 서버에 접근할 수 있음<li>클라이언트는 데이터베이스 서버에 연결을 요청하고 커넥션을 맺게 되고 이때 데이터베이스 서버 내부에는 세션이라는 것을 생성함<ul><li>앞으로 해당 커넥션을 통한 모든 요청은 이 세션을 통해서 실행하게 됨<li>예를 들어 개발자가 클라이언트를 통해 SQL을 전달하면 현재 커넥션에 연결된 세션이 SQL을 실행함</ul><li>세션은 트랜잭션을 실행하고 커밋 또는 롤백을 통해 트랜잭션을 종료 함. 이후 새로운 트랜잭션을 다시 시작 할 수 있음<li>사용자가 커넥션을 닫거나 관리자가 세션을 갈제로 종료하면 세션을 종료됨<li>만약 커넥션 풀이 10개의 커넥션을 생성하면 세션도 10개가 만들어짐</ul><h4 id="트랜잭션의-자동-커밋과-수동-커밋"><span class="mr-2">트랜잭션의 자동 커밋과 수동 커밋</span><a href="#트랜잭션의-자동-커밋과-수동-커밋" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">drop</span> <span class="k">table</span> <span class="n">member</span> <span class="n">if</span> <span class="k">exists</span> <span class="k">cascade</span><span class="p">;</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">member</span> <span class="p">(</span>
    <span class="n">member_id</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">money</span> <span class="nb">integer</span> <span class="k">not</span> <span class="k">null</span> <span class="k">default</span> <span class="mi">0</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">member_id</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 자동 커밋(기본값)</span>
<span class="k">set</span> <span class="n">autocommit</span> <span class="k">true</span><span class="p">;</span> <span class="c1">-- 자동 커밋 모드 설정</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">member</span><span class="p">(</span><span class="n">member_id</span><span class="p">,</span> <span class="n">money</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'data1'</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="c1">-- 자동 커밋</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">member</span><span class="p">(</span><span class="n">member_id</span><span class="p">,</span> <span class="n">money</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'data2'</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="c1">-- 자동 커밋</span>

<span class="c1">-- 수동 커밋</span>
<span class="k">set</span> <span class="n">autocommit</span> <span class="k">false</span><span class="p">;</span> <span class="c1">-- 수종 커밋 모드 설정</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">member</span><span class="p">(</span><span class="n">member_id</span><span class="p">,</span> <span class="n">money</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'data3'</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="c1">-- 수동 커밋</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">member</span><span class="p">(</span><span class="n">member_id</span><span class="p">,</span> <span class="n">money</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'data4'</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="c1">-- 수동 커밋</span>

<span class="c1">-- 트랜잭션 성공하여 커밋</span>
<span class="k">commit</span><span class="p">;</span>

<span class="c1">-- 트랜잭션 실패하여 롤백</span>
<span class="k">rollback</span><span class="p">;</span>
</pre></table></code></div></div><ul><li>자동 커밋<ul><li>자동 커밋으로 설정이 되면 각각의 쿼리 실행 직후에 자동으로 커밋을 호출함.<li>직접 커밋이라 롤백을 호출하지 않아 편리하지만 반대로 쿼리를 하나하나 실행할 떄마다 자동으로 커밋이 되기 떄문에 트랜잭션 기능을 제대로 사용할 수 없음<li>보통 기본 설정값으로 자동 커밋으로 되어있음</ul><li>수동 커밋<ul><li>수동 커밋 모드로 설정하는 것을 트랜잭션을 시작한다고 표현<li>쿼리를 실항한 이후에 커밋, 롤백을 호출해주어야 함</ul></ul><p>수동 커밋 모드나 자동 커밋 모드는 한번 설정하면 해당 세션에서는 계속 유지됨</p><h3 id="db-락"><span class="mr-2">DB 락</span><a href="#db-락" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>세션1이 트랜잭션을 시작하고 데이터를 수정하는 동안 아직 커밋을 수행하지 않았는데 세션2에서 동시에 같은 데이터를 수정하게 되면 데이터의 무결정이 보장되지 않아 여러 문제를 야기함. 바로 트랜잭션의 원자성이 깨져버리게 되는것.</p><p>이러한 문제를 방지하려면 세션이 트랜잭션을 시작하고 데이터를 수정하는 동안에는 커밋이나 롤백 전까지 다른 세션에서 해당 데이터를 수정 할 수 없도록 막아햐 함</p><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_02.png" alt="Alt text" data-proofer-ignore></p><ul><li>세션1은 memberA의 금액을 500원으로 변경하려하고 세션2는 같은 memberA의 금액을 1000원으로 변경하여 함</ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_03.png" alt="Alt text" data-proofer-ignore></p><ul><li>세션1이 먼저 트랜잭션을 시작하여 해당 필드의 락을 획득함<li>락을 소유하고 있으므로 해당 필드에 update SQL을 수행함</ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_04.png" alt="Alt text" data-proofer-ignore></p><ul><li>세션2는 트랜잭션을 수행하려하지만 해당 필드의 락을 획득하지 못하여 대기함<li>무한정 대기하는 것은 아니며 대기시간을 넘어가면 락 타임아웃 오류 발생<ul><li>락 타임아웃 시간은 설정가능함</ul></ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_05.png" alt="Alt text" data-proofer-ignore></p><ul><li>세션1이 커밋을 수행하여 트랜잭션이 완료되고 락을 반환함</ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_06.png" alt="Alt text" data-proofer-ignore></p><ul><li>세션2가 락을 획득</ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_07.png" alt="Alt text" data-proofer-ignore></p><ul><li>세션2가 락을 획득한 이후 update SQL을 수행</ul><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_08.png" alt="Alt text" data-proofer-ignore></p><ul><li>세션2가 커밋을 수행하여 트랜잭션이 완료되고 락을 반환함</ul><h4 id="조회시-db-락"><span class="mr-2">조회시 DB 락</span><a href="#조회시-db-락" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>데이터베이스마다 다르지만 보통의 경우 <strong>일반적으로 조회는 락을 사용하지 않고</strong> 바로 데이터를 조회함 그러나 주요한 계산 및 정보 획득을 위해 데이터를 조회할 떄 “select for update” 구문을 사용하여 락을 획득해 다른 세션에서 해당 데이터를 수정하지 못하게 할 수 있음</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">set</span> <span class="n">autocommit</span> <span class="k">false</span><span class="p">;</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">member</span> <span class="k">where</span> <span class="n">member_id</span><span class="o">=</span><span class="s1">'memberA'</span> <span class="k">for</span> <span class="k">update</span><span class="p">;</span>
<span class="k">commit</span><span class="p">;</span>
</pre></table></code></div></div><ul><li>조회하면서 선택한 필드의 락도 획득함<li>조회할 시점에 락이 없다면 락을 획득할 때까지 대기</ul><h3 id="트랜잭션의-적용"><span class="mr-2">트랜잭션의 적용</span><a href="#트랜잭션의-적용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_09.png" alt="Alt text" data-proofer-ignore></p><ul><li>트랜잭션은 비지니스 로직이 있는 서비스 계층에서 시작해야 함<ul><li>비지니스 로직이 잘못되면 해당 비지니스 로직으로 인한 문제가 되는 부분을 함께 롤백 해야하기 떄문</ul><li>트랜잭션을 시작하려면 커넥션이 필요하기 떄문에 서비스 계층에서 커넥션을 만들고 트랜잭션 커밋 이후 커넥션을 종료해야 함<li>어플리케이션에서 DB 트랜잭션을 사용하려면 <strong>트랜잭션을 사용하는 동안 같은 커넥션을 유지</strong>해야 항상 같은 세션으로 사용할 수 있음<ul><li><img data-src="/assets/posts/img/spring/spring_db_1/spring_db_03_10.png" alt="Alt text" data-proofer-ignore></ul></ul><h3 id="주의"><span class="mr-2">주의</span><a href="#주의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>트랜잭션과 락은 실제 동작하는 방식이 데이터베이스 마다 다르기 떄문에 사용하는 데이터베이스의 메뉴얼을 확일할 필요가 있음</ul><hr /><p>참고</p><ul><li>스프링 DB - 데이터 접근 핵심 원리(김영한)</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/spring-db/'>Spring DB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >Web</a> <a href="/tags/spring-framework/" class="post-tag no-text-decoration" >Spring Framework</a> <a href="/tags/database/" class="post-tag no-text-decoration" >DataBase</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring DB - 트랜잭션 이해 - My Technical Diary&amp;url=https://issuh.github.io/posts/spring-db-03/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring DB - 트랜잭션 이해 - My Technical Diary&amp;u=https://issuh.github.io/posts/spring-db-03/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://issuh.github.io/posts/spring-db-03/&amp;text=Spring DB - 트랜잭션 이해 - My Technical Diary" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/educative-distributed-system-10/">Distributed Systems - Coordination Patterns</a><li><a href="/posts/educative-distributed-system-04/">Distributed Systems - CAP</a><li><a href="/posts/educative-distributed-system-03/">Distributed Systems - Replication</a><li><a href="/posts/my_project_simpledb/">simpleDB - 메모리</a><li><a href="/posts/ps-hackerrank-01/">HackerRandk - Fraudulent Activity Notifications</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-db-01/"><div class="card-body"> <em class="timeago small" data-ts="1697094600" > 2023-10-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring DB - JDBC 이해</h3><div class="text-muted small"><p> JDBC 표준 인터페이스 JDBC(Java Database Connectivity)는 자바에서 데이터베이스에 접속 할 수 있도록 하는 자바 API. JDBC는 데이터베이스에서 자료를 쿼리하거나 업데이트 하는 방법을 제공함 대표적으로 다음 3가지 기능을 표준 인터페이스로 정의해서 제공함 java.sql.Connection : 연결 java...</p></div></div></a></div><div class="card"> <a href="/posts/spring-db-02/"><div class="card-body"> <em class="timeago small" data-ts="1697163000" > 2023-10-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring DB - 커넥션풀과 데이터소스 이해</h3><div class="text-muted small"><p> 커넥션 풀 이해 데이터데이스 커넥션을 획득할 떄는 복잡한 과정을 걸치게 됨 어펄리케이션 로직은 DB 드라이버를 통해 커넥션 조회 DB 드라이버는 DB와 TCP/IP 커넥션 연결 DB 드라이버는 TCP/IP 커넥션이 연결되면 ID, PW와 기타 부가정보를 DB에 전달 DB는 ID, PW를 통해 내부 인증을 완료하고 내부에 DB 세션을...</p></div></div></a></div><div class="card"> <a href="/posts/spring-db-04/"><div class="card-body"> <em class="timeago small" data-ts="1697181600" > 2023-10-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring DB - 스프링을 통한 트랜잭션 동작 개선</h3><div class="text-muted small"><p> 어플리케이션 구조 현재 가장 많이 사용하는 어플리케이션의 구조는 역할에 따라 3가지 계층으로 나누는 것 프리젠테이션 계층 UI와 관련된 처리 담당 웹 요청과 응답 사용자 요청을 검증 주 사용 기술 : 서블릿, HTTP와 같은 웹 기술, 스프링 MVC 서비스 계층 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-db-02/" class="btn btn-outline-primary" prompt="Older"><p>Spring DB - 커넥션풀과 데이터소스 이해</p></a> <a href="/posts/spring-db-04/" class="btn btn-outline-primary" prompt="Newer"><p>Spring DB - 스프링을 통한 트랜잭션 동작 개선</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/ISSuh">ISSuh</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">PS</a> <a class="post-tag" href="/tags/leetcode/">Leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/spring-framework/">Spring Framework</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/hash/">Hash</a> <a class="post-tag" href="/tags/database/">DataBase</a> <a class="post-tag" href="/tags/tree/">Tree</a> <a class="post-tag" href="/tags/array/">Array</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-157715138-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-157715138-1'); }); </script>
